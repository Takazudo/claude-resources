"use strict";(self.webpackChunkclaude_code_doc_site=self.webpackChunkclaude_code_doc_site||[]).push([[8097],{3351(e,s,i){i.d(s,{R:()=>t,x:()=>c});var n=i(2128);const r={},l=n.createContext(r);function t(e){const s=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),n.createElement(l.Provider,{value:s},e.children)}},7130(e,s,i){i.r(s),i.d(s,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>t,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"claude/skills/docusaurus-amplify-fix","title":"docusaurus-amplify-fix","description":"Fix trailing slash 404 errors in Docusaurus sites deployed on AWS Amplify. Use when: (1) Docusaurus documentation pages return 404 with trailing slash URLs (e.g., /docs/page/ returns 404 but /docs/pag...","source":"@site/docs/claude/skills/docusaurus-amplify-fix.mdx","sourceDirName":"claude/skills","slug":"/claude/skills/docusaurus-amplify-fix","permalink":"/docs/claude/skills/docusaurus-amplify-fix","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":null,"lastUpdatedAt":null,"frontMatter":{"title":"docusaurus-amplify-fix","description":"Fix trailing slash 404 errors in Docusaurus sites deployed on AWS Amplify. Use when: (1) Docusaurus documentation pages return 404 with trailing slash URLs (e.g., /docs/page/ returns 404 but /docs/pag..."},"sidebar":"claudeSidebar","previous":{"title":"dependabot-resolve","permalink":"/docs/claude/skills/dependabot-resolve"},"next":{"title":"docusaurus-category-nav","permalink":"/docs/claude/skills/docusaurus-category-nav"}}');var r=i(7900),l=i(3351);const t={title:"docusaurus-amplify-fix",description:"Fix trailing slash 404 errors in Docusaurus sites deployed on AWS Amplify. Use when: (1) Docusaurus documentation pages return 404 with trailing slash URLs (e.g., /docs/page/ returns 404 but /docs/pag..."},c="docusaurus-amplify-fix",d={},o=[{value:"Problem",id:"problem",level:2},{value:"Root Cause",id:"root-cause",level:2},{value:"Solution",id:"solution",level:2},{value:"Implementation",id:"implementation",level:2},{value:"0. Detect Docusaurus Root",id:"0-detect-docusaurus-root",level:3},{value:"1. Add the Script",id:"1-add-the-script",level:3},{value:"2. Update amplify.yml",id:"2-update-amplifyyml",level:3},{value:"3. Verify",id:"3-verify",level:3},{value:"How the Script Works",id:"how-the-script-works",level:2},{value:"Alternative Approaches (Not Recommended)",id:"alternative-approaches-not-recommended",level:2},{value:"\u274c Changing trailingSlash to true",id:"-changing-trailingslash-to-true",level:3},{value:"\u274c Using _redirects file",id:"-using-_redirects-file",level:3},{value:"Script Details",id:"script-details",level:2}];function a(e){const s={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"docusaurus-amplify-fix",children:"docusaurus-amplify-fix"})}),"\n",(0,r.jsx)(s.admonition,{title:"Bundled Resources",type:"info",children:(0,r.jsx)(s.p,{children:"This skill includes: scripts"})}),"\n",(0,r.jsx)(s.h1,{id:"docusaurus--amplify-trailing-slash-fix",children:"Docusaurus + Amplify Trailing Slash Fix"}),"\n",(0,r.jsx)(s.h2,{id:"problem",children:"Problem"}),"\n",(0,r.jsx)(s.p,{children:"Docusaurus sites deployed on AWS Amplify show 404 errors when accessing pages with trailing slash URLs:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"/docs/dev/environment-variables/"})," \u2192 404"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"/docs/dev/environment-variables.html"})," \u2192 works"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"root-cause",children:"Root Cause"}),"\n",(0,r.jsxs)(s.p,{children:["Docusaurus with ",(0,r.jsx)(s.code,{children:"trailingSlash: false"})," (default) generates:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"page.html"})," \u2705 (file exists)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"page/index.html"})," \u274c (does not exist)"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["When users access ",(0,r.jsx)(s.code,{children:"/page/"}),", Amplify looks for ",(0,r.jsx)(s.code,{children:"page/index.html"})," but finds nothing, resulting in 404."]}),"\n",(0,r.jsx)(s.h2,{id:"solution",children:"Solution"}),"\n",(0,r.jsxs)(s.p,{children:["Create ",(0,r.jsx)(s.code,{children:"page/index.html"})," copies for all generated ",(0,r.jsx)(s.code,{children:".html"})," files during the build process. This makes both URL formats work:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"/docs/dev/page.html"})," \u2192 original file"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"/docs/dev/page/"})," \u2192 serves ",(0,r.jsx)(s.code,{children:"page/index.html"})," (copy)"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"implementation",children:"Implementation"}),"\n",(0,r.jsx)(s.h3,{id:"0-detect-docusaurus-root",children:"0. Detect Docusaurus Root"}),"\n",(0,r.jsxs)(s.p,{children:["Find the Docusaurus root directory by locating ",(0,r.jsx)(s.code,{children:"docusaurus.config.ts"})," or ",(0,r.jsx)(s.code,{children:"docusaurus.config.js"})," in the repository. Store this path as ",(0,r.jsx)(s.code,{children:"{DOCUSAURUS_ROOT}"})," and use it for all subsequent steps. For example, if ",(0,r.jsx)(s.code,{children:"docusaurus.config.ts"})," is at ",(0,r.jsx)(s.code,{children:"doc/docusaurus.config.ts"}),", then ",(0,r.jsx)(s.code,{children:"{DOCUSAURUS_ROOT}"})," is ",(0,r.jsx)(s.code,{children:"doc"}),"."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'# Find the Docusaurus root directory\nDOCUSAURUS_ROOT=$(dirname $(find . -maxdepth 3 -name "docusaurus.config.*" -type f | head -1))\necho "Docusaurus root: $DOCUSAURUS_ROOT"\n'})}),"\n",(0,r.jsx)(s.h3,{id:"1-add-the-script",children:"1. Add the Script"}),"\n",(0,r.jsxs)(s.p,{children:["Copy ",(0,r.jsx)(s.code,{children:"scripts/create-trailing-slash-pages.sh"})," to your Docusaurus project:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Create scripts directory if it doesn't exist\nmkdir -p {DOCUSAURUS_ROOT}/scripts\n\n# Copy the script\ncp create-trailing-slash-pages.sh {DOCUSAURUS_ROOT}/scripts/\nchmod +x {DOCUSAURUS_ROOT}/scripts/create-trailing-slash-pages.sh\n"})}),"\n",(0,r.jsx)(s.h3,{id:"2-update-amplifyyml",children:"2. Update amplify.yml"}),"\n",(0,r.jsxs)(s.p,{children:["Add the script execution after the Docusaurus build. Replace ",(0,r.jsx)(s.code,{children:"{DOCUSAURUS_ROOT}"})," with the actual Docusaurus directory path for your project:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"build:\n  commands:\n    - cd {DOCUSAURUS_ROOT} && npm ci && npm run build && bash scripts/create-trailing-slash-pages.sh && cd ../\n"})}),"\n",(0,r.jsx)(s.p,{children:"Full example (adapt paths to your project structure):"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"version: 1\nfrontend:\n  phases:\n    preBuild:\n      commands:\n        - npm ci\n    build:\n      commands:\n        - npm run prod:demo\n        - cd {DOCUSAURUS_ROOT} && npm ci && npm run build && bash scripts/create-trailing-slash-pages.sh && cd ../ && mkdir -p dist/{DOCUSAURUS_ROOT} && cp -r {DOCUSAURUS_ROOT}/build/* dist/{DOCUSAURUS_ROOT}/\n  artifacts:\n    baseDirectory: dist\n    files:\n      - '**/*'\n"})}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Note:"})," The ",(0,r.jsx)(s.code,{children:"amplify.yml"})," paths above use ",(0,r.jsx)(s.code,{children:"{DOCUSAURUS_ROOT}"})," as a placeholder. Replace it with the actual directory name where ",(0,r.jsx)(s.code,{children:"docusaurus.config.ts"})," (or ",(0,r.jsx)(s.code,{children:".js"}),") is located (e.g., ",(0,r.jsx)(s.code,{children:"doc"}),", ",(0,r.jsx)(s.code,{children:"website"}),", ",(0,r.jsx)(s.code,{children:"docs-site"}),", or ",(0,r.jsx)(s.code,{children:"."})," if at the repository root). Also adjust the ",(0,r.jsx)(s.code,{children:"dist/"})," staging directory and ",(0,r.jsx)(s.code,{children:"cp"})," commands to match your project's deployment structure."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"3-verify",children:"3. Verify"}),"\n",(0,r.jsx)(s.p,{children:"After deployment, test that both URL formats work:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://your-site.amplifyapp.com/docs/page.html",children:"https://your-site.amplifyapp.com/docs/page.html"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://your-site.amplifyapp.com/docs/page/",children:"https://your-site.amplifyapp.com/docs/page/"})}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"how-the-script-works",children:"How the Script Works"}),"\n",(0,r.jsx)(s.p,{children:"The script:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Finds all ",(0,r.jsx)(s.code,{children:".html"})," files (except ",(0,r.jsx)(s.code,{children:"index.html"}),")"]}),"\n",(0,r.jsx)(s.li,{children:"Creates a directory with the same name as each file"}),"\n",(0,r.jsxs)(s.li,{children:["Copies the HTML content as ",(0,r.jsx)(s.code,{children:"index.html"})," inside that directory"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Example:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"build/dev/\n\u251c\u2500\u2500 environment-variables.html          # Original\n\u2514\u2500\u2500 environment-variables/\n    \u2514\u2500\u2500 index.html                      # Copy created by script\n"})}),"\n",(0,r.jsx)(s.h2,{id:"alternative-approaches-not-recommended",children:"Alternative Approaches (Not Recommended)"}),"\n",(0,r.jsx)(s.h3,{id:"-changing-trailingslash-to-true",children:"\u274c Changing trailingSlash to true"}),"\n",(0,r.jsxs)(s.p,{children:["Setting ",(0,r.jsx)(s.code,{children:"trailingSlash: true"})," in Docusaurus config breaks existing relative links throughout the documentation, requiring extensive link fixes."]}),"\n",(0,r.jsx)(s.h3,{id:"-using-_redirects-file",children:"\u274c Using _redirects file"}),"\n",(0,r.jsxs)(s.p,{children:["While Amplify supports ",(0,r.jsx)(s.code,{children:"_redirects"})," files, the SPA fallback approach doesn't reliably work for all page types and creates dependency on redirect rules."]}),"\n",(0,r.jsx)(s.h2,{id:"script-details",children:"Script Details"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"create-trailing-slash-pages.sh"})," script is located in ",(0,r.jsx)(s.code,{children:"scripts/"})," and can be used as-is in any Docusaurus + Amplify project."]})]})}function u(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);