"use strict";(self.webpackChunkclaude_code_doc_site=self.webpackChunkclaude_code_doc_site||[]).push([[9559],{3351(e,n,r){r.d(n,{R:()=>s,x:()=>t});var l=r(2128);const o={},c=l.createContext(o);function s(e){const n=l.useContext(c);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),l.createElement(c.Provider,{value:n},e.children)}},7944(e,n,r){r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>t,default:()=>p,frontMatter:()=>s,metadata:()=>l,toc:()=>a});const l=JSON.parse('{"id":"claude/skills/electron-develop/packaging","title":"Packaging & Build","description":"Skill: electron-develop","source":"@site/docs/claude/skills/electron-develop/packaging.mdx","sourceDirName":"claude/skills/electron-develop","slug":"/claude/skills/electron-develop/packaging","permalink":"/docs/claude/skills/electron-develop/packaging","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":null,"lastUpdatedAt":null,"frontMatter":{"title":"Packaging & Build"},"sidebar":"claudeSidebar","previous":{"title":"electron-tabs Reference","permalink":"/docs/claude/skills/electron-develop/electron-tabs"},"next":{"title":"Webview & BrowserWindow Patterns","permalink":"/docs/claude/skills/electron-develop/webview"}}');var o=r(7900),c=r(3351);const s={title:"Packaging & Build"},t="Packaging & Build",i={},a=[{value:"electron-builder with pnpm dlx",id:"electron-builder-with-pnpm-dlx",level:2},{value:"pnpm 10 Compatibility",id:"pnpm-10-compatibility",level:3},{value:"package.json Scripts",id:"packagejson-scripts",level:3},{value:"Shared Modules with extraResources",id:"shared-modules-with-extraresources",level:2},{value:"Why NOT <code>files</code> glob",id:"why-not-files-glob",level:3},{value:"Correct: extraResources",id:"correct-extraresources",level:3},{value:"Dual-path Resolution in main.js",id:"dual-path-resolution-in-mainjs",level:3},{value:"Dynamic Project Root Resolution",id:"dynamic-project-root-resolution",level:2},{value:"Resolution Order",id:"resolution-order",level:3},{value:"Resolving from App Location",id:"resolving-from-app-location",level:3},{value:"Gitignore for Electron Apps",id:"gitignore-for-electron-apps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"packaging--build",children:"Packaging & Build"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Skill:"})," ",(0,o.jsx)(n.a,{href:"/docs/claude/skills/electron-develop",children:"electron-develop"})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h1,{id:"packaging--build-1",children:"Packaging & Build"}),"\n",(0,o.jsx)(n.h2,{id:"electron-builder-with-pnpm-dlx",children:"electron-builder with pnpm dlx"}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.code,{children:"pnpm dlx"})," to avoid installing electron/electron-builder as project dependencies."]}),"\n",(0,o.jsx)(n.h3,{id:"pnpm-10-compatibility",children:"pnpm 10 Compatibility"}),"\n",(0,o.jsxs)(n.p,{children:["pnpm 10 introduces strict security checks that break ",(0,o.jsx)(n.code,{children:"pnpm dlx"})," for Electron packages. Required flags:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pnpm --config.trustPolicy=accept --config.strictDepBuilds=false dlx \\\n  --package=electron@36 --package=electron-builder@26 \\\n  electron-builder --mac -c.electronVersion=36.9.5\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--config.trustPolicy=accept"})," \u2014 bypasses ",(0,o.jsx)(n.code,{children:"ERR_PNPM_TRUST_DOWNGRADE"})," for packages that lost provenance attestation"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--config.strictDepBuilds=false"})," \u2014 bypasses ",(0,o.jsx)(n.code,{children:"ERR_PNPM_IGNORED_BUILDS"})," for dependency build scripts (e.g., electron postinstall)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"-c.electronVersion=36.9.5"})," \u2014 explicit electron version, required because ",(0,o.jsx)(n.code,{children:"pnpm dlx"})," creates isolated environments where electron-builder can't auto-detect the electron version from node_modules"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"packagejson-scripts",children:"package.json Scripts"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "start": "pnpm --config.trustPolicy=accept dlx electron@36 .",\n    "build": "pnpm --config.trustPolicy=accept --config.strictDepBuilds=false dlx --package=electron@36 --package=electron-builder@26 electron-builder --mac -c.electronVersion=36.9.5",\n    "build:dir": "pnpm --config.trustPolicy=accept --config.strictDepBuilds=false dlx --package=electron@36 --package=electron-builder@26 electron-builder --mac --dir -c.electronVersion=36.9.5"\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"shared-modules-with-extraresources",children:"Shared Modules with extraResources"}),"\n",(0,o.jsxs)(n.p,{children:["When multiple Electron apps share common code (e.g., a ",(0,o.jsx)(n.code,{children:"shared/electron-app-core/"})," module), use ",(0,o.jsx)(n.code,{children:"extraResources"})," in electron-builder config \u2014 NOT the ",(0,o.jsx)(n.code,{children:"files"})," glob."]}),"\n",(0,o.jsxs)(n.h3,{id:"why-not-files-glob",children:["Why NOT ",(0,o.jsx)(n.code,{children:"files"})," glob"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'// WRONG - files glob with ../ paths does NOT work reliably\n"files": [\n  "main.js",\n  "../../../shared/electron-app-core/**/*"\n]\n'})}),"\n",(0,o.jsx)(n.p,{children:'The shared module won\'t be included in the asar, causing "Cannot find module" at runtime.'}),"\n",(0,o.jsx)(n.h3,{id:"correct-extraresources",children:"Correct: extraResources"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'// CORRECT - copies shared module to app\'s Resources directory\n"files": ["main.js", "app-config.js", "splash.html", "package.json"],\n"extraResources": [\n  {\n    "from": "../../../shared/electron-app-core",\n    "to": "electron-app-core"\n  }\n]\n'})}),"\n",(0,o.jsx)(n.h3,{id:"dual-path-resolution-in-mainjs",children:"Dual-path Resolution in main.js"}),"\n",(0,o.jsx)(n.p,{children:"The shared module path differs between development and packaged mode:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const { app } = require('electron');\nconst path = require('path');\n\nfunction getSharedCorePath() {\n  if (app.isPackaged) {\n    // Packaged: extraResources copies to Resources/electron-app-core/\n    return path.join(process.resourcesPath, 'electron-app-core');\n  }\n  // Development: relative path to shared directory\n  return path.join(__dirname, '..', '..', '..', 'shared', 'electron-app-core');\n}\n\nconst { setupMenu, createWindowManager } = require(getSharedCorePath());\n"})}),"\n",(0,o.jsx)(n.h2,{id:"dynamic-project-root-resolution",children:"Dynamic Project Root Resolution"}),"\n",(0,o.jsx)(n.p,{children:"Packaged apps need to find their project root (for spawning dev servers). Avoid hardcoding paths \u2014 they break when worktrees or directories change."}),"\n",(0,o.jsx)(n.h3,{id:"resolution-order",children:"Resolution Order"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Saved config"})," \u2014 user previously selected a path (persisted to ",(0,o.jsx)(n.code,{children:"~/.config/&lt;app&gt;/config.json"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"App exe location"})," \u2014 walk up from the app's executable path to find the project"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Default path"})," \u2014 hardcoded fallback"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"User prompt"})," \u2014 show folder picker dialog as last resort"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"resolving-from-app-location",children:"Resolving from App Location"}),"\n",(0,o.jsx)(n.p,{children:"In packaged macOS apps, the executable lives at:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"<electron-app-dir>/dist/mac-arm64/<App>.app/Contents/MacOS/<App>\n"})}),"\n",(0,o.jsx)(n.p,{children:"Walk up 7 levels from the exe to reach the project root (1 level above the electron-app dir):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"function resolveFromAppLocation(config) {\n  try {\n    const exePath = app.getPath('exe');\n    const projectDir = path.resolve(exePath, '..', '..', '..', '..', '..', '..', '..');\n    const packageJsonPath = path.join(projectDir, 'package.json');\n    if (fs.existsSync(packageJsonPath)) {\n      const pkg = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'));\n      if (pkg.name === config.projectName) {\n        return projectDir;\n      }\n    }\n  } catch {\n    // App may have been moved from build location\n  }\n  return null;\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This works when the app is run from its build location within the repo. If the user copies the ",(0,o.jsx)(n.code,{children:".app"})," elsewhere, it falls through to saved config or user prompt."]}),"\n",(0,o.jsx)(n.h2,{id:"gitignore-for-electron-apps",children:"Gitignore for Electron Apps"}),"\n",(0,o.jsx)(n.p,{children:"electron-builder creates build artifacts that should not be committed:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-gitignore",children:"# Electron app build artifacts\n**/electron-app*/dist/\n**/electron-app*/package-lock.json\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"package-lock.json"})," files are generated by electron-builder's internal ",(0,o.jsx)(n.code,{children:"npm install"})," step during packaging."]})]})}function p(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);