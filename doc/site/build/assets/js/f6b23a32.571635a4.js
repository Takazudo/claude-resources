"use strict";(self.webpackChunkclaude_code_doc_site=self.webpackChunkclaude_code_doc_site||[]).push([[6020],{3351(e,n,i){i.d(n,{R:()=>c,x:()=>r});var s=i(2128);const l={},t=s.createContext(l);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:c(e.components),s.createElement(t.Provider,{value:n},e.children)}},6074(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"claude/skills/npm-package-develop/publishing","title":"npm Package Publishing, Versioning, and Quality: Best Practices (2025-2026)","description":"Skill: npm-package-develop","source":"@site/docs/claude/skills/npm-package-develop/publishing.mdx","sourceDirName":"claude/skills/npm-package-develop","slug":"/claude/skills/npm-package-develop/publishing","permalink":"/docs/claude/skills/npm-package-develop/publishing","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":null,"lastUpdatedAt":null,"frontMatter":{"title":"npm Package Publishing, Versioning, and Quality: Best Practices (2025-2026)"},"sidebar":"claudeSidebar","previous":{"title":"npm Package Architecture, Patterns, and Common Gotchas (2025-2026)","permalink":"/docs/claude/skills/npm-package-develop/patterns"},"next":{"title":"npm Package Development Tooling and Project Setup (2025-2026)","permalink":"/docs/claude/skills/npm-package-develop/tooling"}}');var l=i(7900),t=i(3351);const c={title:"npm Package Publishing, Versioning, and Quality: Best Practices (2025-2026)"},r="npm Package Publishing, Versioning, and Quality: Best Practices (2025-2026)",a={},d=[{value:"Semantic Versioning and Release Automation",id:"semantic-versioning-and-release-automation",level:2},{value:"Semver Rules",id:"semver-rules",level:3},{value:"Pre-release Versions",id:"pre-release-versions",level:3},{value:"Release Automation Tool Comparison",id:"release-automation-tool-comparison",level:3},{value:"Changesets",id:"changesets",level:4},{value:"semantic-release",id:"semantic-release",level:4},{value:"release-it",id:"release-it",level:4},{value:"When to Choose Which",id:"when-to-choose-which",level:4},{value:"Publishing Workflow",id:"publishing-workflow",level:2},{value:"The <code>files</code> Field (Recommended Over <code>.npmignore</code>)",id:"the-files-field-recommended-over-npmignore",level:3},{value:"Why Not <code>.npmignore</code>",id:"why-not-npmignore",level:3},{value:"Lifecycle Scripts",id:"lifecycle-scripts",level:3},{value:"Testing with <code>npm pack</code>",id:"testing-with-npm-pack",level:3},{value:"Scoped Packages",id:"scoped-packages",level:3},{value:"Dry-Run Publishing",id:"dry-run-publishing",level:3},{value:"ESM and CJS Dual Publishing",id:"esm-and-cjs-dual-publishing",level:2},{value:"Recommended Package Structure",id:"recommended-package-structure",level:3},{value:"package.json Configuration",id:"packagejson-configuration",level:3},{value:"Building with tsup",id:"building-with-tsup",level:3},{value:"ESM-Only Publishing",id:"esm-only-publishing",level:3},{value:"CI/CD for npm Packages",id:"cicd-for-npm-packages",level:2},{value:"GitHub Actions: Trusted Publishing with OIDC",id:"github-actions-trusted-publishing-with-oidc",level:3},{value:"Setup Steps",id:"setup-steps",level:4},{value:"Workflow File",id:"workflow-file",level:4},{value:"Workflow with Token-Based Auth (Legacy)",id:"workflow-with-token-based-auth-legacy",level:4},{value:"CI Testing Workflow",id:"ci-testing-workflow",level:3},{value:"GitHub Actions with Changesets",id:"github-actions-with-changesets",level:3},{value:"Package Quality Checklist",id:"package-quality-checklist",level:2},{value:"Required Files",id:"required-files",level:3},{value:"Validation Tools",id:"validation-tools",level:3},{value:"publint",id:"publint",level:4},{value:"Are the Types Wrong (attw)",id:"are-the-types-wrong-attw",level:4},{value:"Using Both Together",id:"using-both-together",level:4},{value:"Package Size Optimization",id:"package-size-optimization",level:3},{value:"size-limit",id:"size-limit",level:4},{value:"Bundlephobia",id:"bundlephobia",level:4},{value:"Security",id:"security",level:2},{value:"npm audit",id:"npm-audit",level:3},{value:"Lockfile Practices",id:"lockfile-practices",level:3},{value:"Provenance Attestation",id:"provenance-attestation",level:3},{value:"Supply Chain Security Measures",id:"supply-chain-security-measures",level:3},{value:"The 2025 Shai-Hulud Attack Context",id:"the-2025-shai-hulud-attack-context",level:3},{value:"Documentation",id:"documentation",level:2},{value:"JSDoc / TSDoc",id:"jsdoc--tsdoc",level:3},{value:"TypeDoc",id:"typedoc",level:3},{value:"Pre-Publish Validation",id:"pre-publish-validation",level:2},{value:"Complete Pre-Publish Checklist",id:"complete-pre-publish-checklist",level:3},{value:"Automated Pre-Publish Script",id:"automated-pre-publish-script",level:3},{value:"Checking Bundle Size in CI",id:"checking-bundle-size-in-ci",level:3},{value:"Common Pitfalls and How to Avoid Them",id:"common-pitfalls-and-how-to-avoid-them",level:2},{value:"Forgetting to Build Before Publish",id:"forgetting-to-build-before-publish",level:3},{value:"Including Test Files in the Package",id:"including-test-files-in-the-package",level:3},{value:"Missing Type Declarations",id:"missing-type-declarations",level:3},{value:"Broken ESM/CJS Interop",id:"broken-esmcjs-interop",level:3},{value:"Publishing Sensitive Files",id:"publishing-sensitive-files",level:3},{value:"Not Testing the Published Package",id:"not-testing-the-published-package",level:3},{value:"Incorrect <code>engines</code> Field",id:"incorrect-engines-field",level:3},{value:"Not Setting <code>sideEffects</code>",id:"not-setting-sideeffects",level:3},{value:"Complete package.json Example",id:"complete-packagejson-example",level:2},{value:"Sources",id:"sources",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"npm-package-publishing-versioning-and-quality-best-practices-2025-2026",children:"npm Package Publishing, Versioning, and Quality: Best Practices (2025-2026)"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Skill:"})," ",(0,l.jsx)(n.a,{href:"/docs/claude/skills/npm-package-develop",children:"npm-package-develop"})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h1,{id:"npm-package-publishing-versioning-and-quality-best-practices-2025-2026-1",children:"npm Package Publishing, Versioning, and Quality: Best Practices (2025-2026)"}),"\n",(0,l.jsx)(n.h2,{id:"semantic-versioning-and-release-automation",children:"Semantic Versioning and Release Automation"}),"\n",(0,l.jsx)(n.h3,{id:"semver-rules",children:"Semver Rules"}),"\n",(0,l.jsxs)(n.p,{children:["Semantic versioning follows the ",(0,l.jsx)(n.code,{children:"MAJOR.MINOR.PATCH"})," format:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"MAJOR"})," (e.g. 1.0.0 -> 2.0.0): Breaking changes to the public API. Removing or renaming exports, changing function signatures, dropping Node.js version support"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"MINOR"})," (e.g. 1.0.0 -> 1.1.0): New features that are backward-compatible. Adding new exports, new optional parameters, new configuration options"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"PATCH"})," (e.g. 1.0.0 -> 1.0.1): Bug fixes that are backward-compatible. Fixing incorrect behavior, security patches, documentation typos in JSDoc"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"pre-release-versions",children:"Pre-release Versions"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"1.0.0-alpha.1   # Early testing\n1.0.0-beta.1    # Feature-complete testing\n1.0.0-rc.1      # Release candidate\n"})}),"\n",(0,l.jsx)(n.h3,{id:"release-automation-tool-comparison",children:"Release Automation Tool Comparison"}),"\n",(0,l.jsx)(n.h4,{id:"changesets",children:"Changesets"}),"\n",(0,l.jsx)(n.p,{children:"Recommended for monorepos and teams that want explicit control over versioning decisions. Each PR author adds a changeset file describing the change and its semver impact."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm install -D @changesets/cli\nnpx changeset init\n"})}),"\n",(0,l.jsx)(n.p,{children:"Adding a changeset:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npx changeset\n# Interactive prompts:\n# - Which packages changed?\n# - major / minor / patch?\n# - Summary of the change\n"})}),"\n",(0,l.jsxs)(n.p,{children:["This creates a markdown file in ",(0,l.jsx)(n.code,{children:".changeset/"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-markdown",children:'---\n"@myorg/utils": minor\n---\n\nAdded `formatDate` utility function with timezone support\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Configuration in ",(0,l.jsx)(n.code,{children:".changeset/config.json"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "$schema": "https://unpkg.com/@changesets/config@3.1.1/schema.json",\n  "changelog": "@changesets/changelog-github",\n  "commit": false,\n  "fixed": [],\n  "linked": [],\n  "access": "public",\n  "baseBranch": "main",\n  "updateInternalDependencies": "patch"\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Version bump and publish:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npx changeset version   # Bumps versions, updates CHANGELOG.md\nnpm publish             # Or: npx changeset publish\n"})}),"\n",(0,l.jsx)(n.h4,{id:"semantic-release",children:"semantic-release"}),"\n",(0,l.jsx)(n.p,{children:"Recommended for fully automated pipelines where commit messages drive versioning. Requires strict adherence to Conventional Commits."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm install -D semantic-release\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Configuration in ",(0,l.jsx)(n.code,{children:".releaserc.json"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "branches": ["main"],\n  "plugins": [\n    "@semantic-release/commit-analyzer",\n    "@semantic-release/release-notes-generator",\n    "@semantic-release/changelog",\n    "@semantic-release/npm",\n    [\n      "@semantic-release/git",\n      {\n        "assets": ["package.json", "CHANGELOG.md"],\n        "message": "chore(release): ${nextRelease.version} [skip ci]"\n      }\n    ],\n    "@semantic-release/github"\n  ]\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Conventional Commit examples that trigger version bumps:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"fix: resolve null pointer in parser        -> PATCH\nfeat: add streaming support                 -> MINOR\nfeat\\!: rewrite config format               -> MAJOR\nBREAKING CHANGE: dropped Node 16 support   -> MAJOR\n"})}),"\n",(0,l.jsx)(n.h4,{id:"release-it",children:"release-it"}),"\n",(0,l.jsx)(n.p,{children:"Recommended for simpler setups that want interactive or automated releases without strict commit conventions."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm install -D release-it\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Configuration in ",(0,l.jsx)(n.code,{children:".release-it.json"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "git": {\n    "commitMessage": "chore: release v${version}",\n    "tagName": "v${version}"\n  },\n  "npm": {\n    "publish": true\n  },\n  "github": {\n    "release": true,\n    "releaseName": "v${version}"\n  },\n  "hooks": {\n    "before:init": ["npm test", "npm run lint"],\n    "after:bump": "npx auto-changelog -p"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"when-to-choose-which",children:"When to Choose Which"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Changesets"}),": Monorepos, teams needing human review of version decisions, projects with multiple packages"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"semantic-release"}),": Solo maintainers or teams committed to Conventional Commits, fully automated CI/CD"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"release-it"}),": Small to medium projects, interactive release workflows, flexible commit conventions"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"publishing-workflow",children:"Publishing Workflow"}),"\n",(0,l.jsxs)(n.h3,{id:"the-files-field-recommended-over-npmignore",children:["The ",(0,l.jsx)(n.code,{children:"files"})," Field (Recommended Over ",(0,l.jsx)(n.code,{children:".npmignore"}),")"]}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"files"})," field in ",(0,l.jsx)(n.code,{children:"package.json"})," is a whitelist approach. It explicitly declares which files to include in the published package. This is safer than ",(0,l.jsx)(n.code,{children:".npmignore"})," because new files are excluded by default."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "files": [\n    "dist",\n    "LICENSE",\n    "README.md"\n  ]\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Certain files are always included regardless of the ",(0,l.jsx)(n.code,{children:"files"})," field: ",(0,l.jsx)(n.code,{children:"package.json"}),", ",(0,l.jsx)(n.code,{children:"README"}),", ",(0,l.jsx)(n.code,{children:"LICENSE"}),"/",(0,l.jsx)(n.code,{children:"LICENCE"}),", and the file referenced in ",(0,l.jsx)(n.code,{children:"main"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["Certain files are always excluded: ",(0,l.jsx)(n.code,{children:".git"}),", ",(0,l.jsx)(n.code,{children:"node_modules"}),", ",(0,l.jsx)(n.code,{children:".npmrc"}),", ",(0,l.jsx)(n.code,{children:"package-lock.json"}),", ",(0,l.jsx)(n.code,{children:".DS_Store"}),"."]}),"\n",(0,l.jsxs)(n.h3,{id:"why-not-npmignore",children:["Why Not ",(0,l.jsx)(n.code,{children:".npmignore"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:".npmignore"})," uses a blacklist approach -- new files may accidentally be included"]}),"\n",(0,l.jsxs)(n.li,{children:["If ",(0,l.jsx)(n.code,{children:".npmignore"})," exists, ",(0,l.jsx)(n.code,{children:".gitignore"})," is not consulted for npm packaging"]}),"\n",(0,l.jsxs)(n.li,{children:["Easy to forget updating ",(0,l.jsx)(n.code,{children:".npmignore"})," when adding new development files"]}),"\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"files"})," field is declarative and visible in ",(0,l.jsx)(n.code,{children:"package.json"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"lifecycle-scripts",children:"Lifecycle Scripts"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "build": "tsup src/index.ts --format cjs,esm --dts --clean",\n    "test": "vitest run",\n    "lint": "eslint src/",\n    "prepublishOnly": "npm run lint && npm run test && npm run build",\n    "prepack": "npm run build"\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"prepare"})}),": Runs on ",(0,l.jsx)(n.code,{children:"npm install"})," (local) and before ",(0,l.jsx)(n.code,{children:"npm publish"}),". Use for build steps that consumers installing from git need"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"prepublishOnly"})}),": Runs only before ",(0,l.jsx)(n.code,{children:"npm publish"}),". Use for tests, linting, and builds that should gate publishing"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"prepack"})}),": Runs before ",(0,l.jsx)(n.code,{children:"npm pack"})," and ",(0,l.jsx)(n.code,{children:"npm publish"}),". Use for build steps"]}),"\n"]}),"\n",(0,l.jsxs)(n.h3,{id:"testing-with-npm-pack",children:["Testing with ",(0,l.jsx)(n.code,{children:"npm pack"})]}),"\n",(0,l.jsx)(n.p,{children:"Always inspect the package contents before publishing:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Dry run to see what would be included\nnpm pack --dry-run\n\n# Create the actual tarball for inspection\nnpm pack\n\n# Inspect contents\ntar -tzf mypackage-1.0.0.tgz\n\n# Install locally from tarball to test\ncd /tmp/test-project\nnpm install /path/to/mypackage-1.0.0.tgz\n"})}),"\n",(0,l.jsx)(n.h3,{id:"scoped-packages",children:"Scoped Packages"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "@myorg/utils",\n  "publishConfig": {\n    "access": "public"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Publishing a scoped package as public:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm publish --access public\n"})}),"\n",(0,l.jsx)(n.h3,{id:"dry-run-publishing",children:"Dry-Run Publishing"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm publish --dry-run\n"})}),"\n",(0,l.jsx)(n.p,{children:"This simulates the entire publish process without actually uploading to the registry."}),"\n",(0,l.jsx)(n.h2,{id:"esm-and-cjs-dual-publishing",children:"ESM and CJS Dual Publishing"}),"\n",(0,l.jsx)(n.h3,{id:"recommended-package-structure",children:"Recommended Package Structure"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"my-package/\n  src/\n    index.ts\n  dist/\n    index.js        # ESM\n    index.cjs       # CJS\n    index.d.ts      # Types for ESM\n    index.d.cts     # Types for CJS\n  package.json\n"})}),"\n",(0,l.jsx)(n.h3,{id:"packagejson-configuration",children:"package.json Configuration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "my-package",\n  "version": "1.0.0",\n  "type": "module",\n  "main": "./dist/index.cjs",\n  "module": "./dist/index.js",\n  "types": "./dist/index.d.ts",\n  "exports": {\n    ".": {\n      "import": {\n        "types": "./dist/index.d.ts",\n        "default": "./dist/index.js"\n      },\n      "require": {\n        "types": "./dist/index.d.cts",\n        "default": "./dist/index.cjs"\n      }\n    }\n  },\n  "files": [\n    "dist"\n  ]\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"types"})," condition must come first in each entry. Node.js and TypeScript use the first matching condition."]}),"\n",(0,l.jsx)(n.h3,{id:"building-with-tsup",children:"Building with tsup"}),"\n",(0,l.jsx)(n.p,{children:"tsup (powered by esbuild) is the most commonly recommended build tool for dual-format packages."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm install -D tsup\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"tsup.config.ts"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:'import { defineConfig } from "tsup";\n\nexport default defineConfig({\n  entry: ["src/index.ts"],\n  format: ["cjs", "esm"],\n  dts: true,\n  clean: true,\n  sourcemap: true,\n  splitting: false,\n});\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Or via CLI in ",(0,l.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "build": "tsup src/index.ts --format cjs,esm --dts --clean --sourcemap"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"esm-only-publishing",children:"ESM-Only Publishing"}),"\n",(0,l.jsx)(n.p,{children:"If your package targets modern environments only, ESM-only is simpler and avoids the dual-package hazard."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "type": "module",\n  "exports": {\n    ".": {\n      "types": "./dist/index.d.ts",\n      "default": "./dist/index.js"\n    }\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["As of Node.js v22+, CJS code can ",(0,l.jsx)(n.code,{children:"require()"})," ESM modules natively, reducing the need for dual publishing."]}),"\n",(0,l.jsx)(n.h2,{id:"cicd-for-npm-packages",children:"CI/CD for npm Packages"}),"\n",(0,l.jsx)(n.h3,{id:"github-actions-trusted-publishing-with-oidc",children:"GitHub Actions: Trusted Publishing with OIDC"}),"\n",(0,l.jsx)(n.p,{children:"Trusted publishing (GA since July 2025) eliminates the need for npm access tokens. Authentication happens via short-lived OIDC tokens."}),"\n",(0,l.jsx)(n.h4,{id:"setup-steps",children:"Setup Steps"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Go to npmjs.com -> Package Settings -> Trusted Publishers"}),"\n",(0,l.jsx)(n.li,{children:"Add your GitHub repository, workflow filename, and environment"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"workflow-file",children:"Workflow File"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:".github/workflows/publish.yml"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'name: Publish to npm\n\non:\n  release:\n    types: [published]\n\njobs:\n  publish:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: read\n      id-token: write\n    steps:\n      - uses: actions/checkout@v4\n\n      - uses: actions/setup-node@v4\n        with:\n          node-version: "22.x"\n          registry-url: "https://registry.npmjs.org"\n\n      - run: npm ci\n      - run: npm test\n      - run: npm run build\n      - run: npm publish\n'})}),"\n",(0,l.jsx)(n.p,{children:"Key points:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"id-token: write"})," permission is required for OIDC"]}),"\n",(0,l.jsx)(n.li,{children:"npm CLI 11.5.1+ is required"}),"\n",(0,l.jsxs)(n.li,{children:["Provenance attestations are generated automatically with trusted publishing (no ",(0,l.jsx)(n.code,{children:"--provenance"})," flag needed)"]}),"\n",(0,l.jsxs)(n.li,{children:["No ",(0,l.jsx)(n.code,{children:"NODE_AUTH_TOKEN"})," secret is needed"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"workflow-with-token-based-auth-legacy",children:"Workflow with Token-Based Auth (Legacy)"}),"\n",(0,l.jsx)(n.p,{children:"If trusted publishing is not available, use token-based authentication:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'name: Publish to npm\n\non:\n  release:\n    types: [published]\n\njobs:\n  publish:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: read\n      id-token: write\n    steps:\n      - uses: actions/checkout@v4\n\n      - uses: actions/setup-node@v4\n        with:\n          node-version: "22.x"\n          registry-url: "https://registry.npmjs.org"\n\n      - run: npm ci\n      - run: npm test\n      - run: npm run build\n      - run: npm publish --provenance\n        env:\n          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["For token-based publishing, the ",(0,l.jsx)(n.code,{children:"--provenance"})," flag must be explicitly passed."]}),"\n",(0,l.jsx)(n.h3,{id:"ci-testing-workflow",children:"CI Testing Workflow"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:".github/workflows/ci.yml"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"name: CI\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    strategy:\n      matrix:\n        node-version: [18, 20, 22]\n    steps:\n      - uses: actions/checkout@v4\n\n      - uses: actions/setup-node@v4\n        with:\n          node-version: ${{ matrix.node-version }}\n\n      - run: npm ci\n      - run: npm run lint\n      - run: npm test\n      - run: npm run build\n\n      - name: Validate package\n        run: |\n          npx publint\n          npx attw --pack .\n"})}),"\n",(0,l.jsx)(n.h3,{id:"github-actions-with-changesets",children:"GitHub Actions with Changesets"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'name: Release\n\non:\n  push:\n    branches: [main]\n\njobs:\n  release:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: write\n      pull-requests: write\n      id-token: write\n    steps:\n      - uses: actions/checkout@v4\n\n      - uses: actions/setup-node@v4\n        with:\n          node-version: "22.x"\n          registry-url: "https://registry.npmjs.org"\n\n      - run: npm ci\n\n      - name: Create Release Pull Request or Publish\n        uses: changesets/action@v1\n        with:\n          publish: npx changeset publish\n          version: npx changeset version\n          commit: "chore: version packages"\n          title: "chore: version packages"\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"package-quality-checklist",children:"Package Quality Checklist"}),"\n",(0,l.jsx)(n.h3,{id:"required-files",children:"Required Files"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"README.md"}),": Package description, installation, usage examples, API reference, contributing guide"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"LICENSE"}),": Choose an appropriate open-source license (MIT, Apache-2.0, ISC, etc.)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"CHANGELOG.md"}),": Document all notable changes per version (automated by Changesets or semantic-release)"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"validation-tools",children:"Validation Tools"}),"\n",(0,l.jsx)(n.h4,{id:"publint",children:"publint"}),"\n",(0,l.jsxs)(n.p,{children:["Lints the ",(0,l.jsx)(n.code,{children:"package.json"})," and package structure for common publishing mistakes."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'npx publint\n\n# In package.json scripts for CI\n{\n  "scripts": {\n    "lint:pkg": "publint"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Checks for issues like:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Missing ",(0,l.jsx)(n.code,{children:"exports"})," field"]}),"\n",(0,l.jsxs)(n.li,{children:["Incorrect ",(0,l.jsx)(n.code,{children:"main"}),"/",(0,l.jsx)(n.code,{children:"module"}),"/",(0,l.jsx)(n.code,{children:"types"})," paths"]}),"\n",(0,l.jsx)(n.li,{children:"Files referenced but not included in the package"}),"\n",(0,l.jsxs)(n.li,{children:["Incorrect ",(0,l.jsx)(n.code,{children:"type"})," field usage"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"are-the-types-wrong-attw",children:"Are the Types Wrong (attw)"}),"\n",(0,l.jsxs)(n.p,{children:["Validates that TypeScript type definitions work correctly across different ",(0,l.jsx)(n.code,{children:"moduleResolution"})," settings."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npx @arethetypeswrong/cli --pack .\n\n# Or check a published package\nnpx @arethetypeswrong/cli my-package\n"})}),"\n",(0,l.jsx)(n.p,{children:"Detects issues like:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Types not resolving under ",(0,l.jsx)(n.code,{children:"node16"})," / ",(0,l.jsx)(n.code,{children:"nodenext"})," module resolution"]}),"\n",(0,l.jsxs)(n.li,{children:["Missing ",(0,l.jsx)(n.code,{children:".d.cts"})," or ",(0,l.jsx)(n.code,{children:".d.mts"})," files"]}),"\n",(0,l.jsx)(n.li,{children:"Mismatched ESM/CJS type declarations"}),"\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"FalseCJS"})," problem (CJS types claiming ESM-style default exports)"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"using-both-together",children:"Using Both Together"}),"\n",(0,l.jsx)(n.p,{children:"publint and attw catch different issues. publint performs static analysis of the package structure while attw uses the TypeScript compiler. Both should be used together in CI."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "check:package": "publint && attw --pack ."\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"package-size-optimization",children:"Package Size Optimization"}),"\n",(0,l.jsx)(n.h4,{id:"size-limit",children:"size-limit"}),"\n",(0,l.jsx)(n.p,{children:"Enforces size budgets in CI."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm install -D size-limit @size-limit/preset-small-lib\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:".size-limit.json"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'[\n  {\n    "path": "dist/index.js",\n    "limit": "10 kB"\n  }\n]\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "size": "size-limit",\n    "size:why": "size-limit --why"\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"--why"})," flag opens a treemap visualization showing what contributes to bundle size."]}),"\n",(0,l.jsx)(n.h4,{id:"bundlephobia",children:"Bundlephobia"}),"\n",(0,l.jsxs)(n.p,{children:["Check the install size and bundle size of any npm package at ",(0,l.jsx)(n.a,{href:"https://bundlephobia.com",children:"https://bundlephobia.com"}),". This is useful for comparing dependency choices rather than for validating your own package during development."]}),"\n",(0,l.jsx)(n.h2,{id:"security",children:"Security"}),"\n",(0,l.jsx)(n.h3,{id:"npm-audit",children:"npm audit"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm audit\nnpm audit fix\nnpm audit --omit=dev   # Skip devDependencies\n"})}),"\n",(0,l.jsx)(n.h3,{id:"lockfile-practices",children:"Lockfile Practices"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Always commit ",(0,l.jsx)(n.code,{children:"package-lock.json"})," (or ",(0,l.jsx)(n.code,{children:"pnpm-lock.yaml"})," / ",(0,l.jsx)(n.code,{children:"yarn.lock"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"npm ci"})," in CI environments (installs from lockfile exactly)"]}),"\n",(0,l.jsx)(n.li,{children:"Avoid floating version ranges in production dependencies when possible"}),"\n",(0,l.jsx)(n.li,{children:"Review lockfile diffs in pull requests for unexpected dependency changes"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# CI should use:\nnpm ci              # Not "npm install"\npnpm install --frozen-lockfile\n'})}),"\n",(0,l.jsx)(n.h3,{id:"provenance-attestation",children:"Provenance Attestation"}),"\n",(0,l.jsx)(n.p,{children:'Provenance provides a cryptographic proof that a package was built from a specific source repository and commit, using a specific CI/CD workflow. Consumers can verify this on npmjs.com (look for the green "Provenance" badge).'}),"\n",(0,l.jsx)(n.p,{children:"With trusted publishing, provenance is automatic. With token-based auth:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm publish --provenance\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Or in ",(0,l.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "publishConfig": {\n    "provenance": true\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"supply-chain-security-measures",children:"Supply Chain Security Measures"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Enable 2FA on your npm account (required for publishing if you have tokens)"}),"\n",(0,l.jsx)(n.li,{children:"Use npm trusted publishing to avoid storing long-lived tokens"}),"\n",(0,l.jsx)(n.li,{children:"Pin dependency versions in lockfiles"}),"\n",(0,l.jsx)(n.li,{children:"Review new dependencies before adding them"}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"npm audit signatures"})," to verify package signing"]}),"\n",(0,l.jsx)(n.li,{children:"Consider pnpm's cooldown feature that blocks installation of package versions published within a cooldown period"}),"\n",(0,l.jsx)(n.li,{children:"Monitor for typosquatting on your package name"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"the-2025-shai-hulud-attack-context",children:"The 2025 Shai-Hulud Attack Context"}),"\n",(0,l.jsxs)(n.p,{children:["In September 2025, a self-replicating worm compromised 796 npm packages (132M monthly downloads) via stolen maintainer credentials and malicious ",(0,l.jsx)(n.code,{children:"preinstall"})," scripts. Key defenses:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Use trusted publishing (OIDC) instead of long-lived npm tokens"}),"\n",(0,l.jsxs)(n.li,{children:["Audit ",(0,l.jsx)(n.code,{children:"preinstall"}),"/",(0,l.jsx)(n.code,{children:"postinstall"})," scripts in dependencies"]}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"--ignore-scripts"})," flag when installing untrusted packages"]}),"\n",(0,l.jsx)(n.li,{children:"Monitor for anomalous publishes to your packages"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"documentation",children:"Documentation"}),"\n",(0,l.jsx)(n.h3,{id:"jsdoc--tsdoc",children:"JSDoc / TSDoc"}),"\n",(0,l.jsx)(n.p,{children:"Write inline documentation for all public exports:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:'/**\n * Formats a date string according to the specified locale and options.\n *\n * @param date - The date to format\n * @param locale - BCP 47 language tag (e.g., "en-US", "ja-JP")\n * @param options - Intl.DateTimeFormat options\n * @returns Formatted date string\n *\n * @example\n * ```ts\n * formatDate(new Date(), "en-US", { dateStyle: "long" });\n * // => "February 7, 2026"\n * ```\n *\n * @since 1.2.0\n */\nexport function formatDate(\n  date: Date,\n  locale: string,\n  options?: Intl.DateTimeFormatOptions\n): string {\n  return new Intl.DateTimeFormat(locale, options).format(date);\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"typedoc",children:"TypeDoc"}),"\n",(0,l.jsx)(n.p,{children:"Generate API documentation from TypeScript source code and JSDoc/TSDoc comments."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm install -D typedoc\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"typedoc.json"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "entryPoints": ["src/index.ts"],\n  "out": "docs",\n  "plugin": ["typedoc-plugin-markdown"],\n  "readme": "none",\n  "excludePrivate": true,\n  "excludeInternal": true\n}\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "docs": "typedoc",\n    "docs:watch": "typedoc --watch"\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["TypeDoc reads your TypeScript source and generates HTML or Markdown documentation automatically. The ",(0,l.jsx)(n.code,{children:"typedoc-plugin-markdown"})," plugin generates ",(0,l.jsx)(n.code,{children:".md"})," files suitable for static site generators or GitHub wikis."]}),"\n",(0,l.jsx)(n.h2,{id:"pre-publish-validation",children:"Pre-Publish Validation"}),"\n",(0,l.jsx)(n.h3,{id:"complete-pre-publish-checklist",children:"Complete Pre-Publish Checklist"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# 1. Run tests\nnpm test\n\n# 2. Run linting\nnpm run lint\n\n# 3. Build the package\nnpm run build\n\n# 4. Validate package.json and exports\nnpx publint\n\n# 5. Validate TypeScript types\nnpx @arethetypeswrong/cli --pack .\n\n# 6. Check package size\nnpx size-limit\n\n# 7. Inspect package contents\nnpm pack --dry-run\n\n# 8. Test installation in a temporary project\nnpm pack\ncd "$(mktemp -d)"\nnpm init -y\nnpm install /path/to/my-package-1.0.0.tgz\nnode -e "import(\'my-package\').then(m => console.log(Object.keys(m)))"\n\n# 9. Dry-run publish\nnpm publish --dry-run\n'})}),"\n",(0,l.jsx)(n.h3,{id:"automated-pre-publish-script",children:"Automated Pre-Publish Script"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "prepublishOnly": "npm run lint && npm test && npm run build && npx publint && npx attw --pack .",\n    "prepack": "npm run build"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"checking-bundle-size-in-ci",children:"Checking Bundle Size in CI"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"# In .github/workflows/ci.yml\n- name: Check package size\n  run: npx size-limit\n"})}),"\n",(0,l.jsx)(n.h2,{id:"common-pitfalls-and-how-to-avoid-them",children:"Common Pitfalls and How to Avoid Them"}),"\n",(0,l.jsx)(n.h3,{id:"forgetting-to-build-before-publish",children:"Forgetting to Build Before Publish"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"prepublishOnly"})," script prevents this:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "prepublishOnly": "npm run build"\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["If the ",(0,l.jsx)(n.code,{children:"dist/"})," directory is gitignored (as it should be), a missing build step means publishing an empty or stale package."]}),"\n",(0,l.jsx)(n.h3,{id:"including-test-files-in-the-package",children:"Including Test Files in the Package"}),"\n",(0,l.jsxs)(n.p,{children:["Use the ",(0,l.jsx)(n.code,{children:"files"})," field as a whitelist:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "files": ["dist"]\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Verify with ",(0,l.jsx)(n.code,{children:"npm pack --dry-run"})," that ",(0,l.jsx)(n.code,{children:"__tests__/"}),", ",(0,l.jsx)(n.code,{children:"*.test.ts"}),", ",(0,l.jsx)(n.code,{children:"*.spec.ts"}),", ",(0,l.jsx)(n.code,{children:"jest.config.*"}),", ",(0,l.jsx)(n.code,{children:"vitest.config.*"}),", ",(0,l.jsx)(n.code,{children:".eslintrc.*"}),", and similar files are excluded."]}),"\n",(0,l.jsx)(n.h3,{id:"missing-type-declarations",children:"Missing Type Declarations"}),"\n",(0,l.jsxs)(n.p,{children:["If using TypeScript, ensure ",(0,l.jsx)(n.code,{children:"dts: true"})," in tsup config or ",(0,l.jsx)(n.code,{children:'"declaration": true'})," in ",(0,l.jsx)(n.code,{children:"tsconfig.json"}),". Verify with:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npx @arethetypeswrong/cli --pack .\n"})}),"\n",(0,l.jsx)(n.h3,{id:"broken-esmcjs-interop",children:"Broken ESM/CJS Interop"}),"\n",(0,l.jsx)(n.p,{children:"Common issues:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Missing ",(0,l.jsx)(n.code,{children:'"type": "module"'})," in ",(0,l.jsx)(n.code,{children:"package.json"})," when publishing ESM"]}),"\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"types"})," condition not being first in ",(0,l.jsx)(n.code,{children:"exports"})]}),"\n",(0,l.jsxs)(n.li,{children:["Missing ",(0,l.jsx)(n.code,{children:".d.cts"})," files for CJS consumers using ",(0,l.jsx)(n.code,{children:'moduleResolution: "node16"'})]}),"\n",(0,l.jsxs)(n.li,{children:["Using ",(0,l.jsx)(n.code,{children:"__dirname"})," or ",(0,l.jsx)(n.code,{children:"require"})," in ESM files"]}),"\n",(0,l.jsx)(n.li,{children:"Default export confusion between ESM and CJS"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Prevention:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Run attw to detect interop issues\nnpx @arethetypeswrong/cli --pack .\n\n# Test both import styles\nnode -e \"import('./dist/index.js').then(console.log)\"\nnode -e \"console.log(require('./dist/index.cjs'))\"\n"})}),"\n",(0,l.jsx)(n.h3,{id:"publishing-sensitive-files",children:"Publishing Sensitive Files"}),"\n",(0,l.jsxs)(n.p,{children:["Never publish ",(0,l.jsx)(n.code,{children:".env"}),", credentials, or config files with secrets. The ",(0,l.jsx)(n.code,{children:"files"})," whitelist approach prevents accidental inclusion. Additionally, npm will warn if it detects potential secrets."]}),"\n",(0,l.jsx)(n.h3,{id:"not-testing-the-published-package",children:"Not Testing the Published Package"}),"\n",(0,l.jsxs)(n.p,{children:["The tarball produced by ",(0,l.jsx)(n.code,{children:"npm pack"})," is exactly what gets uploaded to the registry. Always test it:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm pack\nmkdir /tmp/test-install && cd /tmp/test-install\nnpm init -y\nnpm install /path/to/package-1.0.0.tgz\n# Test imports, types, and functionality\n"})}),"\n",(0,l.jsxs)(n.h3,{id:"incorrect-engines-field",children:["Incorrect ",(0,l.jsx)(n.code,{children:"engines"})," Field"]}),"\n",(0,l.jsx)(n.p,{children:"Declare the minimum Node.js version your package supports:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "engines": {\n    "node": ">=18"\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.h3,{id:"not-setting-sideeffects",children:["Not Setting ",(0,l.jsx)(n.code,{children:"sideEffects"})]}),"\n",(0,l.jsx)(n.p,{children:"For tree-shaking support in bundlers:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "sideEffects": false\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Or specify files that do have side effects:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "sideEffects": ["./dist/polyfill.js", "**/*.css"]\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"complete-packagejson-example",children:"Complete package.json Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "@myorg/utils",\n  "version": "1.0.0",\n  "description": "Utility functions for common operations",\n  "type": "module",\n  "main": "./dist/index.cjs",\n  "module": "./dist/index.js",\n  "types": "./dist/index.d.ts",\n  "exports": {\n    ".": {\n      "import": {\n        "types": "./dist/index.d.ts",\n        "default": "./dist/index.js"\n      },\n      "require": {\n        "types": "./dist/index.d.cts",\n        "default": "./dist/index.cjs"\n      }\n    }\n  },\n  "files": [\n    "dist"\n  ],\n  "sideEffects": false,\n  "engines": {\n    "node": ">=18"\n  },\n  "scripts": {\n    "build": "tsup",\n    "test": "vitest run",\n    "lint": "eslint src/",\n    "check:package": "publint && attw --pack .",\n    "size": "size-limit",\n    "docs": "typedoc",\n    "prepublishOnly": "npm run lint && npm test && npm run build && npm run check:package",\n    "prepack": "npm run build"\n  },\n  "publishConfig": {\n    "access": "public",\n    "provenance": true\n  },\n  "repository": {\n    "type": "git",\n    "url": "https://github.com/myorg/utils.git"\n  },\n  "keywords": ["utils", "utilities"],\n  "author": "My Org",\n  "license": "MIT"\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"sources",children:"Sources"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://snyk.io/blog/best-practices-create-modern-npm-package/",children:"Snyk: Best Practices for Creating a Modern npm Package"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.npmjs.com/trusted-publishers/",children:"npm Docs: Trusted Publishing"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.npmjs.com/generating-provenance-statements/",children:"npm Docs: Generating Provenance Statements"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://oleksiipopov.com/blog/npm-release-automation/",children:"Oleksii Popov: NPM Release Automation Comparison"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/changesets/changesets",children:"Changesets GitHub Repository"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://semantic-release.gitbook.io/semantic-release/usage/configuration",children:"semantic-release Configuration"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://lirantal.com/blog/typescript-in-2025-with-esm-and-cjs-npm-publishing",children:"Liran Tal: TypeScript in 2025 with ESM and CJS"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://publint.dev/docs/comparisons",children:"publint"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/arethetypeswrong/arethetypeswrong.github.io",children:"Are the Types Wrong CLI"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.blog/changelog/2025-07-31-npm-trusted-publishing-with-oidc-is-generally-available/",children:"GitHub Blog: npm Trusted Publishing OIDC"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://antfu.me/posts/publish-esm-and-cjs",children:"Antfu: Ship ESM and CJS in One Package"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://tsup.egoist.dev/",children:"tsup Documentation"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/ai/size-limit",children:"size-limit GitHub Repository"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://typedoc.org/",children:"TypeDoc"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://pnpm.io/blog/2025/12/05/newsroom-npm-supply-chain-security",children:"pnpm Blog: Supply Chain Security"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://snyk.io/articles/npm-security-best-practices-shai-hulud-attack/",children:"Snyk: NPM Security Best Practices After Shai Hulud"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.npmjs.com/cli/v8/using-npm/scripts/",children:"npm Docs: Scripts"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/npm/cli/wiki/Files-&-Ignores",children:"npm CLI Wiki: Files and Ignores"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://johnnyreilly.com/dual-publishing-esm-cjs-modules-with-tsup-and-are-the-types-wrong",children:"johnnyreilly: Dual Publishing with tsup and attw"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}}}]);