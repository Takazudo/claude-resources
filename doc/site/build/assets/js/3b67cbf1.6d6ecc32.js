"use strict";(self.webpackChunkclaude_code_doc_site=self.webpackChunkclaude_code_doc_site||[]).push([[949],{3351(e,n,r){r.d(n,{R:()=>l,x:()=>c});var s=r(2128);const o={},t=s.createContext(o);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),s.createElement(t.Provider,{value:n},e.children)}},9901(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>i});const s=JSON.parse('{"id":"claude/skills/electron-develop/background-process","title":"Background Process & Dev Server","description":"Skill: electron-develop","source":"@site/docs/claude/skills/electron-develop/background-process.mdx","sourceDirName":"claude/skills/electron-develop","slug":"/claude/skills/electron-develop/background-process","permalink":"/docs/claude/skills/electron-develop/background-process","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":null,"lastUpdatedAt":null,"frontMatter":{"title":"Background Process & Dev Server"},"sidebar":"claudeSidebar","previous":{"title":"electron-develop","permalink":"/docs/claude/skills/electron-develop"},"next":{"title":"electron-tabs Reference","permalink":"/docs/claude/skills/electron-develop/electron-tabs"}}');var o=r(7900),t=r(3351);const l={title:"Background Process & Dev Server"},c="Background Process & Dev Server",a={},i=[{value:"Basic Structure",id:"basic-structure",level:2},{value:"Shell Environment for nodenv/anyenv",id:"shell-environment-for-nodenvanyenv",level:2},{value:"Starting Dev Server",id:"starting-dev-server",level:2},{value:"Process Group Cleanup (Unix)",id:"process-group-cleanup-unix",level:2},{value:"Splash Screen",id:"splash-screen",level:2},{value:"macOS: Reactivate on Dock Click",id:"macos-reactivate-on-dock-click",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"background-process--dev-server",children:"Background Process & Dev Server"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Skill:"})," ",(0,o.jsx)(n.a,{href:"/docs/claude/skills/electron-develop",children:"electron-develop"})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h1,{id:"background-process--dev-server-1",children:"Background Process & Dev Server"}),"\n",(0,o.jsx)(n.h2,{id:"basic-structure",children:"Basic Structure"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'// main.js\nconst { app, BrowserWindow } = require("electron");\nconst { spawn } = require("child_process");\n\nlet serverProcess = null;\nlet mainWindow = null;\n\napp.whenReady().then(async () => {\n  // 1. Show splash\n  const splash = createSplashWindow();\n\n  // 2. Start server\n  await startDevServer();\n\n  // 3. Show main window\n  splash.close();\n  mainWindow = createMainWindow();\n});\n\napp.on("will-quit", () => stopDevServer());\n'})}),"\n",(0,o.jsx)(n.h2,{id:"shell-environment-for-nodenvanyenv",children:"Shell Environment for nodenv/anyenv"}),"\n",(0,o.jsx)(n.p,{children:"Spawned processes don't inherit version manager PATH. Source shell profile:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'function getShellEnv() {\n  const shell = process.env.SHELL || "/bin/bash";\n  const rcFile = shell.includes("zsh") ? "~/.zshrc" : "~/.bashrc";\n\n  return new Promise((resolve) => {\n    const child = spawn(shell, ["-c", `source ${rcFile} && env`], {\n      env: process.env,\n    });\n\n    let output = "";\n    child.stdout.on("data", (data) => output += data);\n    child.on("close", () => {\n      const env = {};\n      output.split("\\n").forEach((line) => {\n        const [key, ...value] = line.split("=");\n        if (key) env[key] = value.join("=");\n      });\n      resolve(env);\n    });\n  });\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"starting-dev-server",children:"Starting Dev Server"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'async function startDevServer(projectRoot) {\n  const env = await getShellEnv();\n\n  return new Promise((resolve, reject) => {\n    serverProcess = spawn("pnpm", ["start"], {\n      cwd: projectRoot,\n      env,\n      shell: true,\n      detached: true, // Create process group for cleanup\n    });\n\n    // Wait for server ready (look for URL in output)\n    serverProcess.stdout.on("data", (data) => {\n      const output = data.toString();\n      if (output.includes("localhost:") || output.includes("ready")) {\n        resolve();\n      }\n    });\n\n    serverProcess.on("error", reject);\n\n    // Timeout fallback\n    setTimeout(resolve, 10000);\n  });\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"process-group-cleanup-unix",children:"Process Group Cleanup (Unix)"}),"\n",(0,o.jsx)(n.p,{children:"Kill entire process group on exit (important for npm/pnpm which spawn child processes):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'function stopDevServer() {\n  if (serverProcess && !serverProcess.killed) {\n    try {\n      // Negative PID kills entire process group\n      process.kill(-serverProcess.pid, "SIGTERM");\n    } catch (e) {\n      serverProcess.kill("SIGTERM");\n    }\n    serverProcess = null;\n  }\n}\n\n// Register cleanup handlers\napp.on("will-quit", stopDevServer);\nprocess.on("SIGINT", () => { stopDevServer(); app.quit(); });\nprocess.on("SIGTERM", () => { stopDevServer(); app.quit(); });\n'})}),"\n",(0,o.jsx)(n.h2,{id:"splash-screen",children:"Splash Screen"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'function createSplashWindow() {\n  const splash = new BrowserWindow({\n    width: 300,\n    height: 300,\n    frame: false,\n    transparent: true,\n    alwaysOnTop: true,\n    resizable: false,\n    webPreferences: {\n      nodeIntegration: false,\n      contextIsolation: true,\n    },\n  });\n  splash.loadFile("splash.html");\n  return splash;\n}\n'})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",children:'\x3c!-- splash.html --\x3e\n<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    body {\n      margin: 0;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      height: 100vh;\n      background: rgba(30, 30, 30, 0.95);\n      border-radius: 12px;\n      color: white;\n      font-family: -apple-system, sans-serif;\n    }\n    .spinner {\n      width: 40px;\n      height: 40px;\n      border: 3px solid #333;\n      border-top-color: #fff;\n      border-radius: 50%;\n      animation: spin 1s linear infinite;\n    }\n    @keyframes spin { to { transform: rotate(360deg); } }\n  </style>\n</head>\n<body>\n  <div class="spinner"></div>\n  <p>Starting...</p>\n</body>\n</html>\n'})}),"\n",(0,o.jsx)(n.h2,{id:"macos-reactivate-on-dock-click",children:"macOS: Reactivate on Dock Click"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'app.on("activate", async () => {\n  if (BrowserWindow.getAllWindows().length === 0) {\n    if (serverProcess) {\n      createMainWindow(); // Server still running\n    } else {\n      await startDevServer(); // Restart server\n      createMainWindow();\n    }\n  }\n});\n\napp.on("window-all-closed", () => {\n  // Keep running on macOS (dock behavior)\n  if (process.platform !== "darwin") {\n    app.quit();\n  }\n});\n'})})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);