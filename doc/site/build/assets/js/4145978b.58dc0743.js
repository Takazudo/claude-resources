"use strict";(self.webpackChunkclaude_code_doc_site=self.webpackChunkclaude_code_doc_site||[]).push([[7037],{228(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"claude/skills/npm-package-develop/patterns","title":"npm Package Architecture, Patterns, and Common Gotchas (2025-2026)","description":"Skill: npm-package-develop","source":"@site/docs/claude/skills/npm-package-develop/patterns.mdx","sourceDirName":"claude/skills/npm-package-develop","slug":"/claude/skills/npm-package-develop/patterns","permalink":"/docs/claude/skills/npm-package-develop/patterns","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":null,"lastUpdatedAt":null,"frontMatter":{"title":"npm Package Architecture, Patterns, and Common Gotchas (2025-2026)"},"sidebar":"claudeSidebar","previous":{"title":"npm-package-develop","permalink":"/docs/claude/skills/npm-package-develop"},"next":{"title":"npm Package Publishing, Versioning, and Quality: Best Practices (2025-2026)","permalink":"/docs/claude/skills/npm-package-develop/publishing"}}');var l=i(7900),r=i(3351);const t={title:"npm Package Architecture, Patterns, and Common Gotchas (2025-2026)"},a="npm Package Architecture, Patterns, and Common Gotchas (2025-2026)",d={},o=[{value:"Package Types and Patterns",id:"package-types-and-patterns",level:2},{value:"Library Packages",id:"library-packages",level:3},{value:"CLI Tool Packages",id:"cli-tool-packages",level:3},{value:"Full-Stack Utility Packages",id:"full-stack-utility-packages",level:3},{value:"Packages with Native/Binary Dependencies",id:"packages-with-nativebinary-dependencies",level:3},{value:"ESM/CJS Dual Publishing",id:"esmcjs-dual-publishing",level:2},{value:"The Current State",id:"the-current-state",level:3},{value:"The <code>type: &quot;module&quot;</code> Decision",id:"the-type-module-decision",level:3},{value:"When to set <code>&quot;type&quot;: &quot;module&quot;</code>",id:"when-to-set-type-module",level:4},{value:"When to omit it",id:"when-to-omit-it",level:4},{value:"Recommended Dual-Format Configuration",id:"recommended-dual-format-configuration",level:3},{value:"Key points",id:"key-points",level:4},{value:"Build Tools for Dual Publishing",id:"build-tools-for-dual-publishing",level:3},{value:"tsup (recommended for simplicity)",id:"tsup-recommended-for-simplicity",level:4},{value:"unbuild (recommended for flexibility)",id:"unbuild-recommended-for-flexibility",level:4},{value:"pkgroll (zero-config approach)",id:"pkgroll-zero-config-approach",level:4},{value:"Common Interop Issues and Solutions",id:"common-interop-issues-and-solutions",level:3},{value:"<code>__dirname</code> and <code>__filename</code> not available in ESM",id:"__dirname-and-__filename-not-available-in-esm",level:4},{value:"<code>require()</code> not available in ESM",id:"require-not-available-in-esm",level:4},{value:"Dual Package Hazard",id:"dual-package-hazard",level:4},{value:"Verification Tools",id:"verification-tools",level:3},{value:"Package Entry Points",id:"package-entry-points",level:2},{value:"The <code>exports</code> Map",id:"the-exports-map",level:3},{value:"Condition Keys",id:"condition-keys",level:3},{value:"Condition ordering matters",id:"condition-ordering-matters",level:4},{value:"Subpath Exports",id:"subpath-exports",level:3},{value:"Wildcard Exports",id:"wildcard-exports",level:3},{value:"Blocking Internal Access",id:"blocking-internal-access",level:3},{value:"Condition Resolution by Runtime",id:"condition-resolution-by-runtime",level:3},{value:"TypeScript and moduleResolution",id:"typescript-and-moduleresolution",level:3},{value:"Dependency Management",id:"dependency-management",level:2},{value:"dependencies",id:"dependencies",level:3},{value:"devDependencies",id:"devdependencies",level:3},{value:"peerDependencies",id:"peerdependencies",level:3},{value:"Guidelines for peer dependencies",id:"guidelines-for-peer-dependencies",level:4},{value:"peerDependenciesMeta",id:"peerdependenciesmeta",level:3},{value:"optionalDependencies",id:"optionaldependencies",level:3},{value:"bundleDependencies",id:"bundledependencies",level:3},{value:"README Best Practices",id:"readme-best-practices",level:2},{value:"Recommended Structure",id:"recommended-structure",level:3},{value:"Key Sections",id:"key-sections",level:3},{value:"What Not to Include",id:"what-not-to-include",level:3},{value:"Common Mistakes New Package Authors Make",id:"common-mistakes-new-package-authors-make",level:2},{value:"Forgetting the <code>files</code> Field",id:"forgetting-the-files-field",level:3},{value:"Not Testing the Package Locally Before Publishing",id:"not-testing-the-package-locally-before-publishing",level:3},{value:"Using npm pack",id:"using-npm-pack",level:4},{value:"Using npm link",id:"using-npm-link",level:4},{value:"Breaking Changes Without Major Version Bump",id:"breaking-changes-without-major-version-bump",level:3},{value:"Missing or Wrong Types Path",id:"missing-or-wrong-types-path",level:3},{value:"Not Handling Node.js Version Compatibility",id:"not-handling-nodejs-version-compatibility",level:3},{value:"Forgetting <code>prepublishOnly</code>",id:"forgetting-prepublishonly",level:3},{value:"CLI Package Specifics",id:"cli-package-specifics",level:2},{value:"bin Field Configuration",id:"bin-field-configuration",level:3},{value:"Single command",id:"single-command",level:4},{value:"Shorthand (command name matches package name)",id:"shorthand-command-name-matches-package-name",level:4},{value:"Multiple commands",id:"multiple-commands",level:4},{value:"Cross-Platform Shebang",id:"cross-platform-shebang",level:3},{value:"How it works across platforms",id:"how-it-works-across-platforms",level:4},{value:"Line terminator warning",id:"line-terminator-warning",level:4},{value:"Argument Parsing Libraries Comparison",id:"argument-parsing-libraries-comparison",level:3},{value:"commander",id:"commander",level:4},{value:"yargs",id:"yargs",level:4},{value:"citty (unjs)",id:"citty-unjs",level:4},{value:"Choosing a library",id:"choosing-a-library",level:4},{value:"Making Scripts Executable",id:"making-scripts-executable",level:3},{value:"Tree-Shaking and Bundle Optimization",id:"tree-shaking-and-bundle-optimization",level:2},{value:"The sideEffects Field",id:"the-sideeffects-field",level:3},{value:"When to use <code>false</code>",id:"when-to-use-false",level:4},{value:"When to specify an array",id:"when-to-specify-an-array",level:4},{value:"Proper ESM Exports for Tree-Shaking",id:"proper-esm-exports-for-tree-shaking",level:3},{value:"Use named exports, not default exports of objects",id:"use-named-exports-not-default-exports-of-objects",level:4},{value:"Avoid classes when individual functions suffice",id:"avoid-classes-when-individual-functions-suffice",level:4},{value:"Barrel Files and Their Tradeoffs",id:"barrel-files-and-their-tradeoffs",level:3},{value:"Subpath exports as an alternative to barrel files",id:"subpath-exports-as-an-alternative-to-barrel-files",level:4},{value:"Build Configuration for Tree-Shakeable Output",id:"build-configuration-for-tree-shakeable-output",level:3},{value:"tsup with multiple entry points",id:"tsup-with-multiple-entry-points",level:4},{value:"Complete package.json Example",id:"complete-packagejson-example",level:2},{value:"Pre-Publish Checklist",id:"pre-publish-checklist",level:2},{value:"Sources",id:"sources",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"npm-package-architecture-patterns-and-common-gotchas-2025-2026",children:"npm Package Architecture, Patterns, and Common Gotchas (2025-2026)"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Skill:"})," ",(0,l.jsx)(n.a,{href:"/docs/claude/skills/npm-package-develop",children:"npm-package-develop"})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h1,{id:"npm-package-architecture-patterns-and-common-gotchas-2025-2026-1",children:"npm Package Architecture, Patterns, and Common Gotchas (2025-2026)"}),"\n",(0,l.jsx)(n.p,{children:"A comprehensive reference covering package types, ESM/CJS dual publishing, entry points, dependency management, CLI tooling, tree-shaking, and common mistakes."}),"\n",(0,l.jsx)(n.h2,{id:"package-types-and-patterns",children:"Package Types and Patterns"}),"\n",(0,l.jsx)(n.h3,{id:"library-packages",children:"Library Packages"}),"\n",(0,l.jsx)(n.p,{children:"Library packages expose reusable functions, classes, or components. Their primary concern is clean exports, proper type definitions, and tree-shakeability."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "my-lib",\n  "version": "1.0.0",\n  "type": "module",\n  "main": "./dist/index.cjs",\n  "module": "./dist/index.mjs",\n  "types": "./dist/index.d.ts",\n  "exports": {\n    ".": {\n      "import": {\n        "types": "./dist/index.d.mts",\n        "default": "./dist/index.mjs"\n      },\n      "require": {\n        "types": "./dist/index.d.cts",\n        "default": "./dist/index.cjs"\n      }\n    }\n  },\n  "files": ["dist"],\n  "sideEffects": false\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"cli-tool-packages",children:"CLI Tool Packages"}),"\n",(0,l.jsxs)(n.p,{children:["CLI tools use the ",(0,l.jsx)(n.code,{children:"bin"})," field to register executable commands. They require a shebang line and argument parsing."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "my-cli",\n  "version": "1.0.0",\n  "type": "module",\n  "bin": {\n    "my-cli": "./bin/cli.mjs"\n  },\n  "files": ["bin", "dist"],\n  "dependencies": {\n    "commander": "^13.0.0"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"full-stack-utility-packages",children:"Full-Stack Utility Packages"}),"\n",(0,l.jsx)(n.p,{children:"Packages that run in both Node.js and browsers need conditional exports to serve the right code per environment."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": {\n      "browser": {\n        "import": "./dist/browser.mjs",\n        "require": "./dist/browser.cjs"\n      },\n      "node": {\n        "import": "./dist/node.mjs",\n        "require": "./dist/node.cjs"\n      },\n      "default": "./dist/index.mjs"\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"packages-with-nativebinary-dependencies",children:"Packages with Native/Binary Dependencies"}),"\n",(0,l.jsxs)(n.p,{children:["Packages that depend on platform-specific native binaries use ",(0,l.jsx)(n.code,{children:"optionalDependencies"})," to handle multi-platform distribution."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "optionalDependencies": {\n    "@my-pkg/linux-x64": "1.0.0",\n    "@my-pkg/darwin-arm64": "1.0.0",\n    "@my-pkg/win32-x64": "1.0.0"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"The consuming package checks which optional dependency installed successfully and loads the corresponding binary at runtime."}),"\n",(0,l.jsx)(n.h2,{id:"esmcjs-dual-publishing",children:"ESM/CJS Dual Publishing"}),"\n",(0,l.jsx)(n.h3,{id:"the-current-state",children:"The Current State"}),"\n",(0,l.jsxs)(n.p,{children:["As of 2025, the JavaScript ecosystem is in a transitional period. ESM is the standard, but CJS remains deeply embedded in enterprise codebases and tooling. Node.js v22+ natively supports ",(0,l.jsx)(n.code,{children:"require()"})," of ESM modules (previously experimental), but dual publishing is still the pragmatic choice for library authors who want broad compatibility."]}),"\n",(0,l.jsxs)(n.h3,{id:"the-type-module-decision",children:["The ",(0,l.jsx)(n.code,{children:'type: "module"'})," Decision"]}),"\n",(0,l.jsxs)(n.p,{children:["Setting ",(0,l.jsx)(n.code,{children:'"type": "module"'})," in package.json means all ",(0,l.jsx)(n.code,{children:".js"})," files in the package are treated as ESM. Without it, Node.js defaults to CJS for ",(0,l.jsx)(n.code,{children:".js"})," files. The explicit file extensions ",(0,l.jsx)(n.code,{children:".mjs"})," (ESM) and ",(0,l.jsx)(n.code,{children:".cjs"})," (CJS) override this setting regardless."]}),"\n",(0,l.jsxs)(n.h4,{id:"when-to-set-type-module",children:["When to set ",(0,l.jsx)(n.code,{children:'"type": "module"'})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Your package is ESM-first and you want ",(0,l.jsx)(n.code,{children:".js"})," files treated as ESM"]}),"\n",(0,l.jsx)(n.li,{children:"You are writing a modern library where CJS is a secondary output"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"when-to-omit-it",children:"When to omit it"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"You want maximum backward compatibility"}),"\n",(0,l.jsxs)(n.li,{children:["You rely on ",(0,l.jsx)(n.code,{children:".mjs"}),"/",(0,l.jsx)(n.code,{children:".cjs"})," extensions to distinguish formats explicitly"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"recommended-dual-format-configuration",children:"Recommended Dual-Format Configuration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "my-package",\n  "version": "1.0.0",\n  "main": "./dist/index.cjs",\n  "module": "./dist/index.mjs",\n  "types": "./dist/index.d.ts",\n  "exports": {\n    ".": {\n      "require": {\n        "types": "./dist/index.d.cts",\n        "default": "./dist/index.cjs"\n      },\n      "import": {\n        "types": "./dist/index.d.mts",\n        "default": "./dist/index.mjs"\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"key-points",children:"Key points"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"main"})," and ",(0,l.jsx)(n.code,{children:"module"})," provide fallback for older tools that do not support ",(0,l.jsx)(n.code,{children:"exports"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"exports"})," takes priority in Node.js 12.7+ and modern bundlers"]}),"\n",(0,l.jsxs)(n.li,{children:["Type declaration file extensions matter: ",(0,l.jsx)(n.code,{children:".d.cts"})," for CJS consumers, ",(0,l.jsx)(n.code,{children:".d.mts"})," for ESM consumers"]}),"\n",(0,l.jsxs)(n.li,{children:["The ",(0,l.jsx)(n.code,{children:"types"})," condition must appear before ",(0,l.jsx)(n.code,{children:"default"})," within each condition block"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"build-tools-for-dual-publishing",children:"Build Tools for Dual Publishing"}),"\n",(0,l.jsx)(n.h4,{id:"tsup-recommended-for-simplicity",children:"tsup (recommended for simplicity)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"tsup src/index.ts --format cjs,esm --dts --clean\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Powered by esbuild, very fast"}),"\n",(0,l.jsxs)(n.li,{children:["Generates both ",(0,l.jsx)(n.code,{children:".cjs"})," and ",(0,l.jsx)(n.code,{children:".mjs"})," outputs plus ",(0,l.jsx)(n.code,{children:".d.ts"}),"/",(0,l.jsx)(n.code,{children:".d.cts"}),"/",(0,l.jsx)(n.code,{children:".d.mts"})," declarations"]}),"\n",(0,l.jsxs)(n.li,{children:["Automatically shims ",(0,l.jsx)(n.code,{children:"import.meta.url"})," for CJS output"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"unbuild-recommended-for-flexibility",children:"unbuild (recommended for flexibility)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Auto-generates both formats by default"}),"\n",(0,l.jsxs)(n.li,{children:["Stubbing mode (",(0,l.jsx)(n.code,{children:"--stub"}),") enables live development without watchers"]}),"\n",(0,l.jsx)(n.li,{children:"Uses rollup under the hood for clean bundled output"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"pkgroll-zero-config-approach",children:"pkgroll (zero-config approach)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Reads entry points from ",(0,l.jsx)(n.code,{children:"package.json"})," directly"]}),"\n",(0,l.jsx)(n.li,{children:"Uses rollup for bundling and esbuild for transformations"}),"\n",(0,l.jsx)(n.li,{children:"No separate config file needed"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"common-interop-issues-and-solutions",children:"Common Interop Issues and Solutions"}),"\n",(0,l.jsxs)(n.h4,{id:"__dirname-and-__filename-not-available-in-esm",children:[(0,l.jsx)(n.code,{children:"__dirname"})," and ",(0,l.jsx)(n.code,{children:"__filename"})," not available in ESM"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:'// ESM replacement\nimport { fileURLToPath } from "node:url";\nimport { dirname } from "node:path";\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n'})}),"\n",(0,l.jsxs)(n.h4,{id:"require-not-available-in-esm",children:[(0,l.jsx)(n.code,{children:"require()"})," not available in ESM"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:'// ESM replacement\nimport { createRequire } from "node:module";\nconst require = createRequire(import.meta.url);\n\n// Now you can use require() for JSON imports or CJS modules\nconst pkg = require("./package.json");\n'})}),"\n",(0,l.jsx)(n.h4,{id:"dual-package-hazard",children:"Dual Package Hazard"}),"\n",(0,l.jsxs)(n.p,{children:["When the same package is loaded as both ESM and CJS in a single application, two separate instances exist. This can break ",(0,l.jsx)(n.code,{children:"instanceof"})," checks and singleton patterns. The mitigation is to make one format a thin wrapper that re-exports from the other."]}),"\n",(0,l.jsx)(n.h3,{id:"verification-tools",children:"Verification Tools"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"publint"})," (publint.dev): Checks that your package follows distribution best practices"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Are The Types Wrong"})," (@arethetypeswrong/cli): Analyzes TypeScript types for ESM/CJS resolution issues across node10, node16, and bundler module resolution modes"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Check your package before publishing\nnpx publint\nnpx @arethetypeswrong/cli ./my-package-1.0.0.tgz\n"})}),"\n",(0,l.jsx)(n.h2,{id:"package-entry-points",children:"Package Entry Points"}),"\n",(0,l.jsxs)(n.h3,{id:"the-exports-map",children:["The ",(0,l.jsx)(n.code,{children:"exports"})," Map"]}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"exports"})," field (introduced in Node.js 12.7.0) is the modern approach for defining package entry points. When ",(0,l.jsx)(n.code,{children:"exports"})," is defined, it acts as a blocklist: no subpaths are accessible unless explicitly exported, not even ",(0,l.jsx)(n.code,{children:"package.json"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"condition-keys",children:"Condition Keys"}),"\n",(0,l.jsxs)(n.p,{children:["Conditions are keys without a ",(0,l.jsx)(n.code,{children:"."})," prefix. Common conditions include:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"types"})," -- TypeScript type declarations (must appear first)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"import"})," -- Used when loaded via ",(0,l.jsx)(n.code,{children:"import"})," or ",(0,l.jsx)(n.code,{children:"import()"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"require"})," -- Used when loaded via ",(0,l.jsx)(n.code,{children:"require()"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"node"})," -- Node.js-specific entry"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"browser"})," -- Browser-specific entry"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"development"})," / ",(0,l.jsx)(n.code,{children:"production"})," -- Environment-specific"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"default"})," -- Fallback (must appear last)"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"condition-ordering-matters",children:"Condition ordering matters"}),"\n",(0,l.jsxs)(n.p,{children:["Within an exports object, earlier entries take priority. Custom conditions must appear before default conditions (",(0,l.jsx)(n.code,{children:"import"}),", ",(0,l.jsx)(n.code,{children:"require"}),", ",(0,l.jsx)(n.code,{children:"default"}),"). Anything placed after ",(0,l.jsx)(n.code,{children:"default"})," is unreachable."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": {\n      "types": "./dist/index.d.ts",\n      "my-custom-condition": "./dist/custom.js",\n      "import": "./dist/index.mjs",\n      "require": "./dist/index.cjs",\n      "default": "./dist/index.mjs"\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"subpath-exports",children:"Subpath Exports"}),"\n",(0,l.jsx)(n.p,{children:"Subpath exports expose specific modules from your package under clean import paths."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": "./dist/index.mjs",\n    "./utils": "./dist/utils.mjs",\n    "./components/Button": "./dist/components/Button.mjs"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Consumers import with:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:'import { helper } from "my-pkg/utils";\nimport { Button } from "my-pkg/components/Button";\n'})}),"\n",(0,l.jsx)(n.h3,{id:"wildcard-exports",children:"Wildcard Exports"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"*"})," character captures nested paths. It does not behave like glob syntax and may expose more files than expected."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": "./dist/index.mjs",\n    "./components/*": "./dist/components/*.mjs"\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["This maps ",(0,l.jsx)(n.code,{children:"my-pkg/components/Button"})," to ",(0,l.jsx)(n.code,{children:"./dist/components/Button.mjs"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"blocking-internal-access",children:"Blocking Internal Access"}),"\n",(0,l.jsxs)(n.p,{children:["Use ",(0,l.jsx)(n.code,{children:"null"})," to explicitly prevent importing internal paths:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": "./dist/index.mjs",\n    "./internal/*": null\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"condition-resolution-by-runtime",children:"Condition Resolution by Runtime"}),"\n",(0,l.jsx)(n.p,{children:"Different runtimes check different conditions in different orders:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Node.js"}),": ",(0,l.jsx)(n.code,{children:"node"}),", ",(0,l.jsx)(n.code,{children:"import"}),"/",(0,l.jsx)(n.code,{children:"require"}),", ",(0,l.jsx)(n.code,{children:"default"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Vite"}),": ",(0,l.jsx)(n.code,{children:"import"}),"/",(0,l.jsx)(n.code,{children:"require"}),", ",(0,l.jsx)(n.code,{children:"default"}),", ",(0,l.jsx)(n.code,{children:"module"}),", ",(0,l.jsx)(n.code,{children:"browser"}),", ",(0,l.jsx)(n.code,{children:"production"}),"/",(0,l.jsx)(n.code,{children:"development"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"esbuild"}),": ",(0,l.jsx)(n.code,{children:"import"}),"/",(0,l.jsx)(n.code,{children:"require"}),", ",(0,l.jsx)(n.code,{children:"default"}),", ",(0,l.jsx)(n.code,{children:"browser"}),", ",(0,l.jsx)(n.code,{children:"node"}),", ",(0,l.jsx)(n.code,{children:"module"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"webpack"}),": ",(0,l.jsx)(n.code,{children:"import"}),"/",(0,l.jsx)(n.code,{children:"require"}),", ",(0,l.jsx)(n.code,{children:"default"}),", ",(0,l.jsx)(n.code,{children:"browser"}),", ",(0,l.jsx)(n.code,{children:"node"}),", ",(0,l.jsx)(n.code,{children:"module"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"typescript-and-moduleresolution",children:"TypeScript and moduleResolution"}),"\n",(0,l.jsxs)(n.p,{children:["For consumers to use packages with subpath exports in TypeScript, their ",(0,l.jsx)(n.code,{children:"tsconfig.json"})," must set ",(0,l.jsx)(n.code,{children:"moduleResolution"})," to one of:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"node16"})," -- Follows Node.js resolution strictly, requires file extensions in relative imports"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"nodenext"})," -- Same as node16 but tracks the latest Node.js behavior"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"bundler"})," -- Supports ",(0,l.jsx)(n.code,{children:"exports"})," like node16 but allows extensionless imports"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["The older ",(0,l.jsx)(n.code,{children:"node"})," (node10) resolution mode does not support the ",(0,l.jsx)(n.code,{children:"exports"})," field at all."]}),"\n",(0,l.jsx)(n.h2,{id:"dependency-management",children:"Dependency Management"}),"\n",(0,l.jsx)(n.h3,{id:"dependencies",children:"dependencies"}),"\n",(0,l.jsxs)(n.p,{children:["Packages required at runtime. These are installed when a consumer runs ",(0,l.jsx)(n.code,{children:"npm install your-package"}),"."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "dependencies": {\n    "lodash-es": "^4.17.21"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Use for: any module your package imports at runtime."}),"\n",(0,l.jsx)(n.h3,{id:"devdependencies",children:"devDependencies"}),"\n",(0,l.jsx)(n.p,{children:"Packages needed only during development (testing, building, linting). These are not installed for consumers."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "devDependencies": {\n    "tsup": "^8.0.0",\n    "vitest": "^3.0.0",\n    "typescript": "^5.7.0",\n    "@arethetypeswrong/cli": "^0.17.0"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Use for: build tools, test runners, linters, type checkers, bundlers."}),"\n",(0,l.jsx)(n.h3,{id:"peerdependencies",children:"peerDependencies"}),"\n",(0,l.jsx)(n.p,{children:"Packages your library expects the consuming project to provide. The consumer controls the version."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "peerDependencies": {\n    "react": "^18.0.0 || ^19.0.0"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"guidelines-for-peer-dependencies",children:"Guidelines for peer dependencies"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Use only when the dependency must be shared (e.g., React, Vue, Angular)"}),"\n",(0,l.jsxs)(n.li,{children:["Keep version ranges as wide as possible (",(0,l.jsx)(n.code,{children:"^18.0.0"})," not ",(0,l.jsx)(n.code,{children:"~18.2.1"}),")"]}),"\n",(0,l.jsx)(n.li,{children:"Do not overuse; excessive peer dependencies burden consumers with resolution issues"}),"\n",(0,l.jsx)(n.li,{children:"Since npm v7, peer dependencies are installed automatically by default"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"peerdependenciesmeta",children:"peerDependenciesMeta"}),"\n",(0,l.jsx)(n.p,{children:"Mark peer dependencies as optional to suppress warnings when they are not installed."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "peerDependencies": {\n    "react": "^18.0.0 || ^19.0.0",\n    "react-native": ">=0.70.0"\n  },\n  "peerDependenciesMeta": {\n    "react-native": {\n      "optional": true\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"optionaldependencies",children:"optionalDependencies"}),"\n",(0,l.jsx)(n.p,{children:"Dependencies that can fail to install without breaking the package. Your code must handle their absence gracefully."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "optionalDependencies": {\n    "fsevents": "^2.3.0"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:'let fsevents;\ntry {\n  fsevents = await import("fsevents");\n} catch {\n  // Gracefully handle absence - platform does not support fsevents\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Use for: platform-specific binaries, performance-enhancing native addons."}),"\n",(0,l.jsx)(n.h3,{id:"bundledependencies",children:"bundleDependencies"}),"\n",(0,l.jsx)(n.p,{children:"An array of package names that will be bundled into the published tarball. The packages are included in the tarball rather than fetched from the registry."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "bundleDependencies": ["internal-parser", "custom-logger"]\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Use for: packages not available on the npm registry, modified forks of existing packages, or ensuring exact versions ship with your package."}),"\n",(0,l.jsx)(n.h2,{id:"readme-best-practices",children:"README Best Practices"}),"\n",(0,l.jsx)(n.h3,{id:"recommended-structure",children:"Recommended Structure"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-markdown",children:'# package-name\n\nBrief one-line description of what this package does.\n\n[![npm version](https://img.shields.io/npm/v/package-name.svg)](https://www.npmjs.com/package/package-name)\n[![license](https://img.shields.io/npm/l/package-name.svg)](./LICENSE)\n\n## Installation\n\n\\`\\`\\`bash\nnpm install package-name\n\\`\\`\\`\n\n## Usage\n\n\\`\\`\\`js\nimport { something } from "package-name";\n// Minimal working example\n\\`\\`\\`\n\n## API\n\n### `functionName(arg1, arg2)`\n\n- **arg1** (`string`): Description\n- **arg2** (`number`, optional): Description. Defaults to `0`.\n- **Returns**: `Promise<Result>`\n\n## Configuration\n\nDocument any configuration options with defaults.\n\n## Contributing\n\nLink to CONTRIBUTING.md or brief instructions.\n\n## License\n\nMIT\n'})}),"\n",(0,l.jsx)(n.h3,{id:"key-sections",children:"Key Sections"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Package name and description"}),": The single most important thing. Visible immediately on npm"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Badges"}),": npm version, license, CI status, coverage. Use shields.io for generation"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Install instructions"}),": Include both npm and yarn/pnpm variants if your audience expects them"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Usage example"}),": A minimal, copy-pasteable code snippet showing the primary use case"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"API documentation"}),": Every exported function/class with parameters, types, return values, and defaults"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"License"}),": State it explicitly"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"what-not-to-include",children:"What Not to Include"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Implementation details that change frequently"}),"\n",(0,l.jsx)(n.li,{children:"Excessive badges that obscure the actual content"}),"\n",(0,l.jsx)(n.li,{children:"Marketing language or feature comparison tables against competitors"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"common-mistakes-new-package-authors-make",children:"Common Mistakes New Package Authors Make"}),"\n",(0,l.jsxs)(n.h3,{id:"forgetting-the-files-field",children:["Forgetting the ",(0,l.jsx)(n.code,{children:"files"})," Field"]}),"\n",(0,l.jsxs)(n.p,{children:["Without a ",(0,l.jsx)(n.code,{children:"files"})," field, npm publishes almost everything in your project directory (minus ",(0,l.jsx)(n.code,{children:".gitignore"})," entries). This includes test files, source maps, editor configs, and potentially sensitive files."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "files": ["dist", "bin"]\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Always verify before publishing:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm pack --dry-run\n"})}),"\n",(0,l.jsx)(n.p,{children:"This lists exactly which files would be included in the tarball."}),"\n",(0,l.jsx)(n.h3,{id:"not-testing-the-package-locally-before-publishing",children:"Not Testing the Package Locally Before Publishing"}),"\n",(0,l.jsx)(n.h4,{id:"using-npm-pack",children:"Using npm pack"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Create a tarball\nnpm pack\n\n# In a test project, install the tarball\nnpm install ../my-package/my-package-1.0.0.tgz\n"})}),"\n",(0,l.jsx)(n.p,{children:"This simulates exactly what a consumer would get from npm."}),"\n",(0,l.jsx)(n.h4,{id:"using-npm-link",children:"Using npm link"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# In the package directory\nnpm link\n\n# In the consuming project\nnpm link my-package\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Note: ",(0,l.jsx)(n.code,{children:"npm link"})," creates a symlink, which can mask issues that ",(0,l.jsx)(n.code,{children:"npm pack"})," would reveal (missing files, wrong exports). Prefer ",(0,l.jsx)(n.code,{children:"npm pack"})," for final verification."]}),"\n",(0,l.jsx)(n.h3,{id:"breaking-changes-without-major-version-bump",children:"Breaking Changes Without Major Version Bump"}),"\n",(0,l.jsx)(n.p,{children:"Semantic versioning requires a major version bump for any breaking change:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Removing an exported function or changing its signature"}),"\n",(0,l.jsx)(n.li,{children:"Changing the minimum Node.js version"}),"\n",(0,l.jsx)(n.li,{children:"Switching from CJS to ESM-only"}),"\n",(0,l.jsx)(n.li,{children:"Renaming or restructuring exports"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["Use ",(0,l.jsx)(n.code,{children:"npm version major"})," to bump correctly. The command updates ",(0,l.jsx)(n.code,{children:"package.json"}),", ",(0,l.jsx)(n.code,{children:"package-lock.json"}),", creates a git commit, and tags the release."]}),"\n",(0,l.jsx)(n.h3,{id:"missing-or-wrong-types-path",children:"Missing or Wrong Types Path"}),"\n",(0,l.jsxs)(n.p,{children:["TypeScript consumers will silently get ",(0,l.jsx)(n.code,{children:"any"})," types if the ",(0,l.jsx)(n.code,{children:"types"})," field points to a nonexistent file or the wrong location."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Verify types are correct before publishing\nnpx @arethetypeswrong/cli $(npm pack)\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Common type resolution problems detected by ",(0,l.jsx)(n.code,{children:"attw"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Resolution failed (types file does not exist)"}),"\n",(0,l.jsx)(n.li,{children:"Masquerading as CJS (ESM types served for a CJS entry)"}),"\n",(0,l.jsx)(n.li,{children:"Masquerading as ESM (CJS types served for an ESM entry)"}),"\n",(0,l.jsxs)(n.li,{children:["Missing ",(0,l.jsx)(n.code,{children:"export"})," (subpath has no types)"]}),"\n",(0,l.jsx)(n.li,{children:"CJS default export mismatch"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"not-handling-nodejs-version-compatibility",children:"Not Handling Node.js Version Compatibility"}),"\n",(0,l.jsxs)(n.p,{children:["Specify your minimum Node.js version in ",(0,l.jsx)(n.code,{children:"engines"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "engines": {\n    "node": ">=18.0.0"\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Test against your minimum version in CI. Features like top-level await, ",(0,l.jsx)(n.code,{children:"node:"})," protocol imports, and ",(0,l.jsx)(n.code,{children:"structuredClone"})," have specific minimum Node.js versions."]}),"\n",(0,l.jsxs)(n.h3,{id:"forgetting-prepublishonly",children:["Forgetting ",(0,l.jsx)(n.code,{children:"prepublishOnly"})]}),"\n",(0,l.jsxs)(n.p,{children:["Without a build step in ",(0,l.jsx)(n.code,{children:"prepublishOnly"}),", you risk publishing stale dist files or no dist files at all."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "build": "tsup src/index.ts --format cjs,esm --dts --clean",\n    "prepublishOnly": "npm run build"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"cli-package-specifics",children:"CLI Package Specifics"}),"\n",(0,l.jsx)(n.h3,{id:"bin-field-configuration",children:"bin Field Configuration"}),"\n",(0,l.jsx)(n.h4,{id:"single-command",children:"Single command"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "bin": {\n    "my-cli": "./bin/cli.mjs"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"shorthand-command-name-matches-package-name",children:"Shorthand (command name matches package name)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "bin": "./bin/cli.mjs"\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"multiple-commands",children:"Multiple commands"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "bin": {\n    "my-cli": "./bin/cli.mjs",\n    "my-cli-init": "./bin/init.mjs"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"cross-platform-shebang",children:"Cross-Platform Shebang"}),"\n",(0,l.jsx)(n.p,{children:"The shebang must be the very first line of the file:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:'#!/usr/bin/env node\n\nimport { program } from "commander";\n// ...\n'})}),"\n",(0,l.jsx)(n.h4,{id:"how-it-works-across-platforms",children:"How it works across platforms"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Unix/macOS"}),": The OS reads the shebang to determine the interpreter"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Windows"}),": npm reads the shebang during installation and generates a ",(0,l.jsx)(n.code,{children:".cmd"})," wrapper alongside the script. Windows ignores the shebang line itself (treated as a comment)"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"line-terminator-warning",children:"Line terminator warning"}),"\n",(0,l.jsxs)(n.p,{children:["If developing on Windows, ensure the shebang line uses ",(0,l.jsx)(n.code,{children:"\\n"})," (LF), not ",(0,l.jsx)(n.code,{children:"\\r\\n"})," (CRLF). A ",(0,l.jsx)(n.code,{children:"\\r"})," at the end of the shebang makes Unix systems look for ",(0,l.jsx)(n.code,{children:"node\\r"})," instead of ",(0,l.jsx)(n.code,{children:"node"}),". Configure your editor to use LF for the bin files."]}),"\n",(0,l.jsx)(n.h3,{id:"argument-parsing-libraries-comparison",children:"Argument Parsing Libraries Comparison"}),"\n",(0,l.jsx)(n.h4,{id:"commander",children:"commander"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Most popular CLI framework (weekly downloads: millions)"}),"\n",(0,l.jsx)(n.li,{children:"Object-oriented, programmatic API"}),"\n",(0,l.jsx)(n.li,{children:"Strong subcommand support with Git-style nesting"}),"\n",(0,l.jsx)(n.li,{children:"Automatic help generation"}),"\n",(0,l.jsx)(n.li,{children:"Mature and stable"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:'#!/usr/bin/env node\nimport { program } from "commander";\n\nprogram\n  .name("my-cli")\n  .version("1.0.0")\n  .description("A sample CLI tool");\n\nprogram\n  .command("init")\n  .description("Initialize a new project")\n  .option("-t, --template <name>", "template to use", "default")\n  .action((options) => {\n    console.log(`Initializing with template: ${options.template}`);\n  });\n\nprogram.parse();\n'})}),"\n",(0,l.jsx)(n.h4,{id:"yargs",children:"yargs"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Fluent, chainable API"}),"\n",(0,l.jsx)(n.li,{children:"Built-in middleware support"}),"\n",(0,l.jsx)(n.li,{children:"Extensive input validation"}),"\n",(0,l.jsx)(n.li,{children:"Dynamic argument parsing"}),"\n",(0,l.jsx)(n.li,{children:"Powerful completion generation"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:'#!/usr/bin/env node\nimport yargs from "yargs";\nimport { hideBin } from "yargs/helpers";\n\nyargs(hideBin(process.argv))\n  .command(\n    "init",\n    "Initialize a new project",\n    (yargs) => {\n      return yargs.option("template", {\n        alias: "t",\n        type: "string",\n        default: "default",\n        describe: "Template to use",\n      });\n    },\n    (argv) => {\n      console.log(`Initializing with template: ${argv.template}`);\n    }\n  )\n  .demandCommand(1)\n  .help()\n  .parse();\n'})}),"\n",(0,l.jsx)(n.h4,{id:"citty-unjs",children:"citty (unjs)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Lightweight, ESM-first CLI builder from the UnJS ecosystem"}),"\n",(0,l.jsx)(n.li,{children:"Lazy and async command loading"}),"\n",(0,l.jsx)(n.li,{children:"Auto-generated usage and help"}),"\n",(0,l.jsx)(n.li,{children:"Under active development (v0.1.6 as of early 2025)"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:'#!/usr/bin/env node\nimport { defineCommand, runMain } from "citty";\n\nconst main = defineCommand({\n  meta: {\n    name: "my-cli",\n    version: "1.0.0",\n    description: "A sample CLI tool",\n  },\n  args: {\n    template: {\n      type: "string",\n      description: "Template to use",\n      default: "default",\n    },\n  },\n  run({ args }) {\n    console.log(`Initializing with template: ${args.template}`);\n  },\n});\n\nrunMain(main);\n'})}),"\n",(0,l.jsx)(n.h4,{id:"choosing-a-library",children:"Choosing a library"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"commander"}),": Best for traditional, feature-complete CLIs with deep subcommand trees"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"yargs"}),": Best when you need middleware, validation, and dynamic parsing"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"citty"}),": Best for modern ESM-first projects in the UnJS ecosystem or when you want async command loading"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"making-scripts-executable",children:"Making Scripts Executable"}),"\n",(0,l.jsx)(n.p,{children:"After creating your CLI file, ensure it is executable on Unix systems:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"chmod +x bin/cli.mjs\n"})}),"\n",(0,l.jsx)(n.p,{children:"npm handles this automatically during installation, but during development you may need to set the permission manually."}),"\n",(0,l.jsx)(n.h2,{id:"tree-shaking-and-bundle-optimization",children:"Tree-Shaking and Bundle Optimization"}),"\n",(0,l.jsx)(n.h3,{id:"the-sideeffects-field",children:"The sideEffects Field"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"sideEffects"})," field tells bundlers (webpack, rollup, vite, esbuild) whether modules in your package have side effects. When set to ",(0,l.jsx)(n.code,{children:"false"}),", the bundler can safely remove any unused exports."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "sideEffects": false\n}\n'})}),"\n",(0,l.jsxs)(n.h4,{id:"when-to-use-false",children:["When to use ",(0,l.jsx)(n.code,{children:"false"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Pure utility libraries (lodash-style)"}),"\n",(0,l.jsx)(n.li,{children:"Component libraries where each component is self-contained"}),"\n",(0,l.jsx)(n.li,{children:"Any package where importing a module does not modify global state"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"when-to-specify-an-array",children:"When to specify an array"}),"\n",(0,l.jsx)(n.p,{children:"If some files do have side effects (e.g., CSS imports, polyfills), list them explicitly:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "sideEffects": ["*.css", "./src/polyfills.js"]\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"proper-esm-exports-for-tree-shaking",children:"Proper ESM Exports for Tree-Shaking"}),"\n",(0,l.jsxs)(n.p,{children:["Tree-shaking works by analyzing static ",(0,l.jsx)(n.code,{children:"import"}),"/",(0,l.jsx)(n.code,{children:"export"})," statements. CJS modules use dynamic ",(0,l.jsx)(n.code,{children:"require()"})," which is not statically analyzable, making tree-shaking impossible for CJS."]}),"\n",(0,l.jsx)(n.h4,{id:"use-named-exports-not-default-exports-of-objects",children:"Use named exports, not default exports of objects"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"// Good: named exports are tree-shakeable\nexport function formatDate(date) { /* ... */ }\nexport function parseDate(str) { /* ... */ }\n\n// Bad: default export of an object is NOT tree-shakeable\nexport default {\n  formatDate(date) { /* ... */ },\n  parseDate(str) { /* ... */ },\n};\n"})}),"\n",(0,l.jsx)(n.h4,{id:"avoid-classes-when-individual-functions-suffice",children:"Avoid classes when individual functions suffice"}),"\n",(0,l.jsx)(n.p,{children:"Class methods cannot be individually tree-shaken. If a consumer imports the class, all methods are included."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"// Bad for tree-shaking: all methods included even if only one is used\nexport class DateUtils {\n  static formatDate(date) { /* ... */ }\n  static parseDate(str) { /* ... */ }\n}\n\n// Good for tree-shaking: each function is independently removable\nexport function formatDate(date) { /* ... */ }\nexport function parseDate(str) { /* ... */ }\n"})}),"\n",(0,l.jsx)(n.h3,{id:"barrel-files-and-their-tradeoffs",children:"Barrel Files and Their Tradeoffs"}),"\n",(0,l.jsxs)(n.p,{children:["A barrel file (",(0,l.jsx)(n.code,{children:"index.js"}),") re-exports from multiple modules:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:'// src/index.js\nexport { formatDate } from "./format.js";\nexport { parseDate } from "./parse.js";\nexport { validateDate } from "./validate.js";\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Barrel files are convenient for consumers but can hinder tree-shaking if ",(0,l.jsx)(n.code,{children:"sideEffects"})," is not set to ",(0,l.jsx)(n.code,{children:"false"}),". Without that flag, the bundler must assume each re-exported module might have side effects and cannot safely remove it."]}),"\n",(0,l.jsx)(n.h4,{id:"subpath-exports-as-an-alternative-to-barrel-files",children:"Subpath exports as an alternative to barrel files"}),"\n",(0,l.jsx)(n.p,{children:"Instead of a single barrel file, expose individual modules directly:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": "./dist/index.mjs",\n    "./format": "./dist/format.mjs",\n    "./parse": "./dist/parse.mjs",\n    "./validate": "./dist/validate.mjs"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"This lets consumers import only what they need without relying on barrel file tree-shaking:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:'// Consumer only loads the format module\nimport { formatDate } from "my-date-lib/format";\n'})}),"\n",(0,l.jsx)(n.h3,{id:"build-configuration-for-tree-shakeable-output",children:"Build Configuration for Tree-Shakeable Output"}),"\n",(0,l.jsx)(n.h4,{id:"tsup-with-multiple-entry-points",children:"tsup with multiple entry points"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:'// tsup.config.ts\nimport { defineConfig } from "tsup";\n\nexport default defineConfig({\n  entry: [\n    "src/index.ts",\n    "src/format.ts",\n    "src/parse.ts",\n    "src/validate.ts",\n  ],\n  format: ["esm", "cjs"],\n  dts: true,\n  splitting: true,\n  clean: true,\n});\n'})}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"splitting: true"})," option enables code splitting, which helps avoid duplicating shared code across entry points."]}),"\n",(0,l.jsx)(n.h2,{id:"complete-packagejson-example",children:"Complete package.json Example"}),"\n",(0,l.jsx)(n.p,{children:"A comprehensive example combining the patterns discussed above:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "@scope/my-library",\n  "version": "1.0.0",\n  "description": "A concise description of what this package does",\n  "type": "module",\n  "main": "./dist/index.cjs",\n  "module": "./dist/index.mjs",\n  "types": "./dist/index.d.ts",\n  "exports": {\n    ".": {\n      "require": {\n        "types": "./dist/index.d.cts",\n        "default": "./dist/index.cjs"\n      },\n      "import": {\n        "types": "./dist/index.d.mts",\n        "default": "./dist/index.mjs"\n      }\n    },\n    "./utils": {\n      "require": {\n        "types": "./dist/utils.d.cts",\n        "default": "./dist/utils.cjs"\n      },\n      "import": {\n        "types": "./dist/utils.d.mts",\n        "default": "./dist/utils.mjs"\n      }\n    }\n  },\n  "files": ["dist"],\n  "sideEffects": false,\n  "engines": {\n    "node": ">=18.0.0"\n  },\n  "scripts": {\n    "build": "tsup",\n    "check-types": "attw --pack .",\n    "check-publish": "publint",\n    "prepublishOnly": "npm run build && npm run check-types && npm run check-publish"\n  },\n  "keywords": ["relevant", "keywords"],\n  "author": "Your Name",\n  "license": "MIT",\n  "repository": {\n    "type": "git",\n    "url": "https://github.com/user/repo.git"\n  },\n  "devDependencies": {\n    "@arethetypeswrong/cli": "^0.17.0",\n    "publint": "^0.3.0",\n    "tsup": "^8.0.0",\n    "typescript": "^5.7.0"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"pre-publish-checklist",children:"Pre-Publish Checklist"}),"\n",(0,l.jsxs)(n.p,{children:["Before running ",(0,l.jsx)(n.code,{children:"npm publish"}),":"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Run ",(0,l.jsx)(n.code,{children:"npm pack --dry-run"})," to verify only intended files are included"]}),"\n",(0,l.jsxs)(n.li,{children:["Run ",(0,l.jsx)(n.code,{children:"npx publint"})," to check distribution best practices"]}),"\n",(0,l.jsxs)(n.li,{children:["Run ",(0,l.jsx)(n.code,{children:"npx @arethetypeswrong/cli $(npm pack)"})," to verify TypeScript types resolve correctly"]}),"\n",(0,l.jsxs)(n.li,{children:["Install the tarball in a test project: ",(0,l.jsx)(n.code,{children:"npm install ../my-pkg-1.0.0.tgz"})]}),"\n",(0,l.jsxs)(n.li,{children:["Test ",(0,l.jsx)(n.code,{children:"import"})," and ",(0,l.jsx)(n.code,{children:"require()"})," both work in the test project"]}),"\n",(0,l.jsxs)(n.li,{children:["Verify ",(0,l.jsx)(n.code,{children:"engines.node"})," matches your minimum supported version"]}),"\n",(0,l.jsx)(n.li,{children:"Confirm the version bump follows semver (major for breaking changes)"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"sources",children:"Sources"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://hirok.io/posts/package-json-exports",children:"Guide to the package.json exports field (Hiroki Osame)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://antfu.me/posts/publish-esm-and-cjs",children:"Ship ESM and CJS in one Package (Anthony Fu)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://lirantal.com/blog/typescript-in-2025-with-esm-and-cjs-npm-publishing",children:"TypeScript in 2025 with ESM and CJS npm publishing (Liran Tal)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://snyk.io/blog/building-npm-package-compatible-with-esm-and-cjs-2024/",children:"Building an npm package compatible with ESM and CJS (Snyk)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://kentcdodds.com/blog/tips-for-making-a-cli-based-tool-with-node",children:"Tips for making a CLI-based tool with Node (Kent C. Dodds)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://nodejs.org/api/packages.html",children:"Node.js Packages Documentation"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/arethetypeswrong/arethetypeswrong.github.io",children:"Are The Types Wrong CLI"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/unjs/citty",children:"citty - Elegant CLI Builder (UnJS)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.smashingmagazine.com/2021/05/tree-shaking-reference-guide/",children:"Tree-Shaking Reference Guide (Smashing Magazine)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://dev.to/icy0307/peer-dependencies-in-depth-1o3b",children:"Peer Dependencies in Depth"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://dorshinar.me/posts/treeshaking-with-tsup",children:"Tree-shakable library with tsup"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://webpack.js.org/guides/tree-shaking/",children:"webpack Tree Shaking documentation"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://johnnyreilly.com/dual-publishing-esm-cjs-modules-with-tsup-and-are-the-types-wrong",children:"Dual Publishing ESM and CJS with tsup (John Reilly)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://2ality.com/2022/07/nodejs-esm-shell-scripts.html",children:"Creating ESM-based shell scripts for Unix and Windows (Dr. Axel Rauschmayer)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://blog.greenroots.info/the-npm-dependency-handbook-for-you",children:"The npm Dependency Handbook"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},3351(e,n,i){i.d(n,{R:()=>t,x:()=>a});var s=i(2128);const l={},r=s.createContext(l);function t(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);