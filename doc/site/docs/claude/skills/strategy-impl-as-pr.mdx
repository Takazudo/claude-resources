---
title: "strategy-impl-as-pr"
description: "Start a development workflow as a draft PR. Fetches, creates a branch, makes an empty start commit, pushes, and opens a draft PR. Then starts implementation if instructions are provided. Also handles ..."
---

# strategy-impl-as-pr



# Dev As PR

Start a development workflow by creating a branch and draft PR before implementation — or create a PR from existing work on the current branch.

## Input Parsing

Parse `$ARGUMENTS` to extract:

- **GitHub issue**: URL (`https://github.com/owner/repo/issues/123`) or number (`123` or `#123`)
- **Branch name**: Explicit branch name if provided (look for words like `branch:` or a slash-containing name like `topic/foo`)
- **Base branch**: Explicit base branch if provided (look for words like `base:` or `from:`)
- **Implementation instructions**: Any remaining text describing what to implement

If ambiguous, ask the user to clarify.

## Mode Detection

Before starting the workflow, detect which mode to use:

### Check Current State

```bash
git fetch origin
CURRENT_BRANCH=$(git branch --show-current)
DEFAULT_BRANCH=$(git remote show origin | grep 'HEAD branch' | awk '{print $NF}')
```

### Existing-Work Mode

Use **Existing-Work Mode** when ALL of these are true:

1. The current branch is NOT the default branch (e.g., not `main` or `master`)
2. There are commits on the current branch that are not on the default branch (`git log origin/$DEFAULT_BRANCH..$CURRENT_BRANCH --oneline` shows commits)
3. No PR already exists for this branch (`gh pr view $CURRENT_BRANCH` returns error / not found)

### Fresh-Start Mode

Use **Fresh-Start Mode** in all other cases (on the default branch, no extra commits, or a PR already exists).

---

## Fresh-Start Mode (default)

This is the original workflow for starting new work.

### Step 1: Read Issue (if specified)

```bash
# If GitHub URL
gh issue view <issue-num> --repo <owner/repo>

# If issue number
gh issue view <issue-num>
```

Use the issue title and body as context for branch naming and implementation.

### Step 2: Determine Branch Name

If user specified a branch name, use it directly.

Otherwise, derive `{SLUG}` (max 40 chars, lowercase, hyphens) from the issue title or implementation description, then:

| Condition | Branch name pattern |
|-----------|-------------------|
| Has issue | `issue-#&lt;ISSUE_NO&gt;/&lt;SLUG&gt;` |
| Documentation updates | `doc/&lt;SLUG&gt;` |
| Other | `topic/&lt;SLUG&gt;` |

### Step 3: Determine Target (Base) Branch

- If user specified a base branch, use it
- Otherwise, use the current locally checked-out branch

Record this as `TARGET_BRANCH`.

### Step 4: Create Branch and Draft PR

```bash
# Create and switch to new branch from TARGET_BRANCH
git checkout -b <BRANCH_NAME> <TARGET_BRANCH>

# Create empty start commit
git commit --allow-empty -m "= start <SLUG> dev ="

# Push to remote
git push -u origin <BRANCH_NAME>

# Create draft PR against TARGET_BRANCH
gh pr create \
  --base <TARGET_BRANCH> \
  --title "<PR_TITLE>" \
  --body "$(cat <<'EOF'
## Summary
<brief description based on issue or instructions>

## Changes
- (in progress)

## Test Plan
- (to be determined)
EOF
)" \
  --draft
```

The PR title should be descriptive based on the issue or instructions provided.

### Step 5: Start Implementation

If the user provided implementation instructions (either via issue or direct text), begin the implementation work immediately.

If no instructions were provided, report the PR URL and wait for further direction.

---

## Existing-Work Mode

Use this when implementation is already done (or nearly done) on the current branch.

### Step 1: Gather Context

```bash
# Identify current branch and base
CURRENT_BRANCH=$(git branch --show-current)
DEFAULT_BRANCH=$(git remote show origin | grep 'HEAD branch' | awk '{print $NF}')

# Review what was done
git log origin/$DEFAULT_BRANCH..$CURRENT_BRANCH --oneline
git diff origin/$DEFAULT_BRANCH...$CURRENT_BRANCH --stat
```

If the user specified a base branch, use that instead of `DEFAULT_BRANCH` as `TARGET_BRANCH`. Otherwise, use `DEFAULT_BRANCH`.

If the user specified an issue, read it for PR title/body context.

### Step 2: Stage and Commit Remaining Work (if any)

If there are uncommitted changes (staged or unstaged):

```bash
git add <relevant-files>
git commit -m "<descriptive message>"
```

Follow normal commit conventions — no empty commits, meaningful messages.

### Step 3: Push and Create Draft PR

```bash
# Push current branch to remote
git push -u origin $CURRENT_BRANCH

# Create draft PR against TARGET_BRANCH
gh pr create \
  --base <TARGET_BRANCH> \
  --title "<PR_TITLE>" \
  --body "$(cat <<'EOF'
## Summary
<brief description based on commits and diff>

## Changes
- <list actual changes from the diff/commits>

## Test Plan
- <describe how changes were tested, if known>
EOF
)" \
  --draft
```

The PR title and body should reflect the **actual work done** (derived from commit messages and diff), not placeholder text.

### Step 4: Continue or Report

If the user provided additional implementation instructions, continue working on the branch and commit/push as needed.

If no further instructions were provided, report the PR URL and wait for direction.

---

## Examples

### Fresh-start: with issue number

```
/strategy-impl-as-pr 42
-> Fetch, detect on main → Fresh-Start Mode
-> Read issue #42 "Add dark mode support"
-> Branch: issue-#42/add-dark-mode-support
-> Base: main
-> Empty commit, push, draft PR
-> Start implementing based on issue
```

### Fresh-start: with explicit branch and base

```
/strategy-impl-as-pr branch:feature/new-auth base:develop
-> Fetch, detect on develop → Fresh-Start Mode
-> Branch: feature/new-auth
-> Base: develop
-> Empty commit, push, draft PR
```

### Fresh-start: with instructions only

```
/strategy-impl-as-pr add pagination to the user list page
-> Fetch, detect on main → Fresh-Start Mode
-> Branch: topic/add-pagination-user-list
-> Base: main
-> Empty commit, push, draft PR
-> Start implementing pagination
```

### Existing-work: implementation already done on branch

```
/strategy-impl-as-pr
-> Fetch, detect on topic/add-search-feature with 3 commits ahead → Existing-Work Mode
-> Push branch, create draft PR with summary from actual commits
-> Report PR URL
```

### Existing-work: with issue reference for context

```
/strategy-impl-as-pr 42
-> Fetch, detect on issue-#42/add-dark-mode with commits ahead → Existing-Work Mode
-> Read issue #42 for PR title/body context
-> Push branch, create draft PR
-> Report PR URL
```

