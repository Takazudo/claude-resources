---
name: dev-docusaurus
description: >-
  Common Docusaurus v3/v4 development fixes and configuration tweaks. Use when: (1) Setting up or
  maintaining a Docusaurus site, (2) Seeing warnings about deprecated config options like
  onBrokenMarkdownLinks, (3) Getting "Module not found" errors for @docusaurus/theme-common or
  plugin-content-docs when swizzling with pnpm, (4) Generated docs produce broken link warnings that
  should be suppressed, (5) Using autogenerated sidebar with category ordering, (6) Making docs the
  homepage, (7) Optimizing generated docs for hot reload, (8) User says 'docusaurus fix',
  'docusaurus warnings', 'fix docusaurus config'.
---

# Docusaurus Development Fixes

Configuration tweaks and patterns for Docusaurus v3.x projects.

## Fix 1: Suppress Broken Link Warnings for Generated Docs

When docs are auto-generated from external sources (e.g., Claude Code skills, API specs), they often contain internal references (`references/foo.md`) that don't resolve in Docusaurus. These warnings are noise.

In `docusaurus.config.ts` (or `.js`):

```js
const config = {
  // Suppress broken link errors for generated docs with internal references
  onBrokenLinks: "ignore",

  markdown: {
    // v4-compatible location for onBrokenMarkdownLinks
    hooks: {
      onBrokenMarkdownLinks: "ignore",
    },
  },
};
```

**Important:** Do NOT use the top-level `onBrokenMarkdownLinks` option — it is deprecated since Docusaurus v3.6+ and will be removed in v4. Always place it under `markdown.hooks.onBrokenMarkdownLinks` instead.

## Fix 2: Explicit Dependencies for pnpm + Swizzled Components

When swizzling Docusaurus theme components (e.g., `DocItem/Content`) under **pnpm**, imports like `@docusaurus/theme-common` and `@docusaurus/plugin-content-docs/client` fail with "Module not found" because pnpm's strict dependency resolution doesn't hoist transitive deps from `@docusaurus/preset-classic`.

Fix: install them explicitly.

```bash
pnpm add @docusaurus/theme-common @docusaurus/plugin-content-docs
```

This is only needed when the project uses pnpm AND has swizzled components that import from these packages. npm/yarn hoist these automatically.

## Autogenerated Sidebar with Category Ordering

Use `autogenerated` sidebar instead of manually building sidebar JSON:

```js
// sidebars.js
const sidebars = {
  mySidebar: [{ type: 'autogenerated', dirName: 'my-docs' }],
};
module.exports = sidebars;
```

Control category order with `_category_.json` files in each directory:

```json
{ "position": 2, "label": "Getting Started" }
```

Each category's `index.mdx` should have `sidebar_position: 1` in frontmatter so it appears first within its category.

**Important for generated docs:** If your generation script has a `removeStaleItems` function that cleans up old files, make sure it preserves `_category_.json`:

```javascript
expectedFiles.add("_category_.json");
```

## Making Docs the Homepage

To make a doc page the site's homepage (no separate landing page):

1. Set `routeBasePath: "/"` in the docs plugin config:

```js
docs: {
  routeBasePath: "/",
  // ...other options
},
```

2. Add `slug: /` to the doc's frontmatter:

```yaml
---
slug: /
sidebar_position: 1
---
```

3. Remove or empty the navbar items if not needed:

```js
navbar: {
  items: [],
},
```

4. Delete `src/pages/index.tsx` (or `.js`) and its CSS module — Docusaurus's pages plugin takes priority over docs for the root route, so the pages file must be removed.

## Optimizing Generated Docs for Hot Reload

When a generation script produces docs that Docusaurus watches, writing ALL files on every run triggers a full webpack rebuild (~20-30s). Use a `writeFileIfChanged` helper to only write files with actual content changes:

```javascript
function writeFileIfChanged(filePath, content) {
  if (fs.existsSync(filePath)) {
    const existing = fs.readFileSync(filePath, "utf8");
    if (existing === content) return false;
  }
  fs.writeFileSync(filePath, content);
  return true;
}
```

This enables Docusaurus fast HMR for content-only changes. The distinction:

- **Editing existing file content** → only that `.mdx` file is rewritten → Docusaurus HMR (instant)
- **Adding/removing files** → new routes → Docusaurus full webpack rebuild (~20-30s, unavoidable)

## Stale File Cleanup: Write First, Delete After

When regenerating docs that a running dev server watches, **write new files before deleting stale ones**. If you delete first, the dev server sees missing files and throws "Module not found" errors.

```javascript
// WRONG - delete first causes transient errors
cleanDir(outputDir);
writeFiles(outputDir, newFiles);

// CORRECT - write first, then remove only stale files
writeFiles(outputDir, newFiles);
removeStaleItems(outputDir, expectedFileSet);

function removeStaleItems(dir, expectedItems) {
  for (const item of fs.readdirSync(dir)) {
    if (!expectedItems.has(item)) {
      const p = path.join(dir, item);
      fs.statSync(p).isDirectory() ? fs.rmSync(p, { recursive: true }) : fs.unlinkSync(p);
    }
  }
}
```
